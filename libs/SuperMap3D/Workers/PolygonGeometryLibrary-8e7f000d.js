define(["exports","./when-b60132fc","./Check-7b2a090c","./Cartesian2-99e64452","./EllipsoidRhumbLine-d305ae76","./Cartesian4-69ef58e5","./Cartographic-00721f3e","./FeatureDetection-ab6f364c","./buildModuleUrl-9a89655b","./GeometryAttribute-f3b3c776","./GeometryAttributes-252e9929","./GeometryPipeline-ff15c36b","./IndexDatatype-d62ee188","./Math-119be1a3","./earcut-2.2.1-20c8012f","./PrimitiveType-ebb8c588","./WebGLConstants-aba9fc67","./Transforms-f4127659"],(function(e,t,a,i,r,n,o,s,u,h,l,c,p,d,f,m,y,C){"use strict";var g={CLOCKWISE:y.WebGLConstants.CW,COUNTER_CLOCKWISE:y.WebGLConstants.CCW,validate:function(e){return e===g.CLOCKWISE||e===g.COUNTER_CLOCKWISE}},v=Object.freeze(g),b=new n.Cartesian3,E=new n.Cartesian3,w={computeArea2D:function(e){for(var t=e.length,a=0,i=t-1,r=0;r<t;i=r++){var n=e[i],o=e[r];a+=n.x*o.y-o.x*n.y}return.5*a},computeWindingOrder2D:function(e){return w.computeArea2D(e)>0?v.COUNTER_CLOCKWISE:v.CLOCKWISE},triangulate:function(e,t){var a=i.Cartesian2.packArray(e);return f.earcut(a,t,2)}},x=new n.Cartesian3,M=new n.Cartesian3,T=new n.Cartesian3,S=new n.Cartesian3,A=new n.Cartesian3,I=new n.Cartesian3,L=new n.Cartesian3;w.computeSubdivision=function(e,a,i,r,o){o=t.defaultValue(o,!1),r=t.defaultValue(r,d.CesiumMath.RADIANS_PER_DEGREE);var u,l=i.slice(0),c=a.length,p=new Array(3*c),f=0;for(u=0;u<c;u++){var y=a[u];p[f++]=y.x,p[f++]=y.y,p[f++]=y.z}for(var C=[],g={},v=e.maximumRadius,b=d.CesiumMath.chordLength(r,v),E=b*b;l.length>0;){var w,G,D=l.pop(),R=l.pop(),_=l.pop(),P=n.Cartesian3.fromArray(p,3*_,x),O=n.Cartesian3.fromArray(p,3*R,M),N=n.Cartesian3.fromArray(p,3*D,T),z=o?P:n.Cartesian3.multiplyByScalar(n.Cartesian3.normalize(P,S),v,S),B=o?O:n.Cartesian3.multiplyByScalar(n.Cartesian3.normalize(O,A),v,A),W=o?N:n.Cartesian3.multiplyByScalar(n.Cartesian3.normalize(N,I),v,I),q=n.Cartesian3.magnitudeSquared(n.Cartesian3.subtract(z,B,L)),V=n.Cartesian3.magnitudeSquared(n.Cartesian3.subtract(B,W,L)),U=n.Cartesian3.magnitudeSquared(n.Cartesian3.subtract(W,z,L)),k=Math.max(q,V,U);k>E?q===k?(u=g[w=Math.min(_,R)+" "+Math.max(_,R)],t.defined(u)||(G=n.Cartesian3.add(P,O,L),n.Cartesian3.multiplyByScalar(G,.5,G),p.push(G.x,G.y,G.z),u=p.length/3-1,g[w]=u),l.push(_,u,D),l.push(u,R,D)):V===k?(u=g[w=Math.min(R,D)+" "+Math.max(R,D)],t.defined(u)||(G=n.Cartesian3.add(O,N,L),n.Cartesian3.multiplyByScalar(G,.5,G),p.push(G.x,G.y,G.z),u=p.length/3-1,g[w]=u),l.push(R,u,_),l.push(u,D,_)):U===k&&(u=g[w=Math.min(D,_)+" "+Math.max(D,_)],t.defined(u)||(G=n.Cartesian3.add(N,P,L),n.Cartesian3.multiplyByScalar(G,.5,G),p.push(G.x,G.y,G.z),u=p.length/3-1,g[w]=u),l.push(D,u,R),l.push(u,_,R)):(C.push(_),C.push(R),C.push(D))}return new h.Geometry({attributes:{position:new h.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p})},indices:C,primitiveType:m.PrimitiveType.TRIANGLES})};var G=new o.Cartographic,D=new o.Cartographic,R=new o.Cartographic,_=new o.Cartographic;function P(){this._array=[],this._offset=0,this._length=0}w.computeRhumbLineSubdivision=function(e,a,i,o){o=t.defaultValue(o,d.CesiumMath.RADIANS_PER_DEGREE);var u,l=i.slice(0),c=a.length,p=new Array(3*c),f=0;for(u=0;u<c;u++){var y=a[u];p[f++]=y.x,p[f++]=y.y,p[f++]=y.z}for(var C=[],g={},v=e.maximumRadius,b=d.CesiumMath.chordLength(o,v),E=new r.EllipsoidRhumbLine(void 0,void 0,e),w=new r.EllipsoidRhumbLine(void 0,void 0,e),S=new r.EllipsoidRhumbLine(void 0,void 0,e);l.length>0;){var A=l.pop(),I=l.pop(),P=l.pop(),O=n.Cartesian3.fromArray(p,3*P,x),N=n.Cartesian3.fromArray(p,3*I,M),z=n.Cartesian3.fromArray(p,3*A,T),B=e.cartesianToCartographic(O,G),W=e.cartesianToCartographic(N,D),q=e.cartesianToCartographic(z,R);E.setEndPoints(B,W);var V=E.surfaceDistance;w.setEndPoints(W,q);var U=w.surfaceDistance;S.setEndPoints(q,B);var k,H,F,K,Y=S.surfaceDistance,Q=Math.max(V,U,Y);Q>b?V===Q?(u=g[k=Math.min(P,I)+" "+Math.max(P,I)],t.defined(u)||(H=E.interpolateUsingFraction(.5,_),F=.5*(B.height+W.height),K=n.Cartesian3.fromRadians(H.longitude,H.latitude,F,e,L),p.push(K.x,K.y,K.z),u=p.length/3-1,g[k]=u),l.push(P,u,A),l.push(u,I,A)):U===Q?(u=g[k=Math.min(I,A)+" "+Math.max(I,A)],t.defined(u)||(H=w.interpolateUsingFraction(.5,_),F=.5*(W.height+q.height),K=n.Cartesian3.fromRadians(H.longitude,H.latitude,F,e,L),p.push(K.x,K.y,K.z),u=p.length/3-1,g[k]=u),l.push(I,u,P),l.push(u,A,P)):Y===Q&&(u=g[k=Math.min(A,P)+" "+Math.max(A,P)],t.defined(u)||(H=S.interpolateUsingFraction(.5,_),F=.5*(q.height+B.height),K=n.Cartesian3.fromRadians(H.longitude,H.latitude,F,e,L),p.push(K.x,K.y,K.z),u=p.length/3-1,g[k]=u),l.push(A,u,I),l.push(u,P,I)):(C.push(P),C.push(I),C.push(A))}return new h.Geometry({attributes:{position:new h.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p})},indices:C,primitiveType:m.PrimitiveType.TRIANGLES})},w.scaleToGeodeticHeight=function(e,a,i,r){i=t.defaultValue(i,u.Ellipsoid.WGS84);var o=b,s=E;if(a=t.defaultValue(a,0),r=t.defaultValue(r,!0),t.defined(e))for(var h=e.length,l=0;l<h;l+=3)n.Cartesian3.fromArray(e,l,s),r&&(s=i.scaleToGeodeticSurface(s,s)),0!==a&&(o=i.geodeticSurfaceNormal(s,o),n.Cartesian3.multiplyByScalar(o,a,o),n.Cartesian3.add(s,o,s)),e[l]=s.x,e[l+1]=s.y,e[l+2]=s.z;return e},Object.defineProperties(P.prototype,{length:{get:function(){return this._length}}}),P.prototype.enqueue=function(e){this._array.push(e),this._length++},P.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,a=e[t];return e[t]=void 0,++t>10&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,a}},P.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},P.prototype.contains=function(e){return-1!==this._array.indexOf(e)},P.prototype.clear=function(){this._array.length=this._offset=this._length=0},P.prototype.sort=function(e){this._offset>0&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var O={computeHierarchyPackedLength:function(e){for(var a=0,i=[e];i.length>0;){var r=i.pop();if(t.defined(r)){a+=2;var o=r.positions,s=r.holes;if(t.defined(o)&&(a+=o.length*n.Cartesian3.packedLength),t.defined(s))for(var u=s.length,h=0;h<u;++h)i.push(s[h])}}return a},packPolygonHierarchy:function(e,a,i){for(var r=[e];r.length>0;){var o=r.pop();if(t.defined(o)){var s=o.positions,u=o.holes;if(a[i++]=t.defined(s)?s.length:0,a[i++]=t.defined(u)?u.length:0,t.defined(s))for(var h=s.length,l=0;l<h;++l,i+=3)n.Cartesian3.pack(s[l],a,i);if(t.defined(u))for(var c=u.length,p=0;p<c;++p)r.push(u[p])}}return i},unpackPolygonHierarchy:function(e,t){for(var a=e[t++],i=e[t++],r=new Array(a),o=i>0?new Array(i):void 0,s=0;s<a;++s,t+=n.Cartesian3.packedLength)r[s]=n.Cartesian3.unpack(e,t);for(var u=0;u<i;++u)o[u]=O.unpackPolygonHierarchy(e,t),t=o[u].startingIndex,delete o[u].startingIndex;return{positions:r,holes:o,startingIndex:t}}},N=new n.Cartesian3;function z(e,t,a,i){return n.Cartesian3.subtract(t,e,N),n.Cartesian3.multiplyByScalar(N,a/i,N),n.Cartesian3.add(e,N,N),[N.x,N.y,N.z]}O.subdivideLineCount=function(e,t,a){var i=n.Cartesian3.distance(e,t)/a,r=Math.max(0,Math.ceil(d.CesiumMath.log2(i)));return Math.pow(2,r)};var B=new o.Cartographic,W=new o.Cartographic,q=new o.Cartographic,V=new n.Cartesian3;O.subdivideRhumbLineCount=function(e,t,a,i){var n=e.cartesianToCartographic(t,B),o=e.cartesianToCartographic(a,W),s=new r.EllipsoidRhumbLine(n,o,e).surfaceDistance/i,u=Math.max(0,Math.ceil(d.CesiumMath.log2(s)));return Math.pow(2,u)},O.subdivideLine=function(e,a,i,r){var o=O.subdivideLineCount(e,a,i),s=n.Cartesian3.distance(e,a),u=s/o;t.defined(r)||(r=[]);var h=r;h.length=3*o;for(var l=0,c=0;c<o;c++){var p=z(e,a,c*u,s);h[l++]=p[0],h[l++]=p[1],h[l++]=p[2]}return h},O.subdivideRhumbLine=function(e,a,i,n,o){var s=e.cartesianToCartographic(a,B),u=e.cartesianToCartographic(i,W),h=new r.EllipsoidRhumbLine(s,u,e),l=h.surfaceDistance/n,c=Math.max(0,Math.ceil(d.CesiumMath.log2(l))),p=Math.pow(2,c),f=h.surfaceDistance/p;t.defined(o)||(o=[]);var m=o;m.length=3*p;for(var y=0,C=0;C<p;C++){var g=h.interpolateUsingSurfaceDistance(C*f,q),v=e.cartographicToCartesian(g,V);m[y++]=v.x,m[y++]=v.y,m[y++]=v.z}return m};var U=new n.Cartesian3,k=new n.Cartesian3,H=new n.Cartesian3,F=new n.Cartesian3;O.scaleToGeodeticHeightExtruded=function(e,a,i,r,o){r=t.defaultValue(r,u.Ellipsoid.WGS84);var s=U,h=k,l=H,c=F;if(t.defined(e)&&t.defined(e.attributes)&&t.defined(e.attributes.position))for(var p=e.attributes.position.values,d=p.length/2,f=0;f<d;f+=3)n.Cartesian3.fromArray(p,f,l),r.geodeticSurfaceNormal(l,s),c=r.scaleToGeodeticSurface(l,c),h=n.Cartesian3.multiplyByScalar(s,i,h),h=n.Cartesian3.add(c,h,h),p[f+d]=h.x,p[f+1+d]=h.y,p[f+2+d]=h.z,o&&(c=n.Cartesian3.clone(l,c)),h=n.Cartesian3.multiplyByScalar(s,a,h),h=n.Cartesian3.add(c,h,h),p[f]=h.x,p[f+1]=h.y,p[f+2]=h.z;return e},O.polygonOutlinesFromHierarchy=function(e,a,i){var o,s,u,h=[],l=new P;for(l.enqueue(e);0!==l.length;){var c=l.dequeue(),p=c.positions;if(a)for(u=p.length,o=0;o<u;o++)i.scaleToGeodeticSurface(p[o],p[o]);if(!((p=r.arrayRemoveDuplicates(p,n.Cartesian3.equalsEpsilon,!0)).length<3)){var d=c.holes?c.holes.length:0;for(o=0;o<d;o++){var f=c.holes[o],m=f.positions;if(a)for(u=m.length,s=0;s<u;++s)i.scaleToGeodeticSurface(m[s],m[s]);if(!((m=r.arrayRemoveDuplicates(m,n.Cartesian3.equalsEpsilon,!0)).length<3)){h.push(m);var y=0;for(t.defined(f.holes)&&(y=f.holes.length),s=0;s<y;s++)l.enqueue(f.holes[s])}}h.push(p)}}return h};var K=new n.Cartesian3(6378137,6378137,6378137);O.polygonsFromHierarchy=function(e,a,i,o){var s=[],u=[],h=new P;for(h.enqueue(e);0!==h.length;){var l,c,p,f=h.dequeue(),m=f.positions,y=f.holes,C=m.slice();if(i)for(c=m.length,l=0;l<c;l++)o.scaleToGeodeticSurface(m[l],C[l]);if(t.defined(o)&&!n.Cartesian3.equals(o._radii,K)&&(p=d.CesiumMath.EPSILON7),!((m=r.arrayRemoveDuplicates(C,n.Cartesian3.equalsEpsilon,!0,p)).length<3)){var g=a(m);if(t.defined(g)){var b=[],E=w.computeWindingOrder2D(g);E===v.CLOCKWISE&&(g.reverse(),m=m.slice().reverse());var x,M=m.slice(),T=t.defined(y)?y.length:0,S=[];for(l=0;l<T;l++){var A=y[l],I=A.positions;if(i)for(c=I.length,x=0;x<c;++x)o.scaleToGeodeticSurface(I[x],I[x]);if(!((I=r.arrayRemoveDuplicates(I,n.Cartesian3.equalsEpsilon,!0,d.CesiumMath.EPSILON7)).length<3)){var L=a(I);if(t.defined(L)){(E=w.computeWindingOrder2D(L))===v.CLOCKWISE&&(L.reverse(),I=I.slice().reverse()),S.push(I),b.push(M.length),M=M.concat(I),g=g.concat(L);var G=0;for(t.defined(A.holes)&&(G=A.holes.length),x=0;x<G;x++)h.enqueue(A.holes[x])}}}s.push({outerRing:m,holes:S}),u.push({positions:M,positions2D:g,holes:b})}}}return{hierarchy:s,polygons:u}};var Y=new i.Cartesian2,Q=new n.Cartesian3,j=new C.Quaternion,J=new i.Matrix3;O.computeBoundingRectangle=function(e,a,r,o,s){for(var u=C.Quaternion.fromAxisAngle(e,o,j),h=i.Matrix3.fromQuaternion(u,J),l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,p=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f=r.length,m=0;m<f;++m){var y=n.Cartesian3.clone(r[m],Q);i.Matrix3.multiplyByVector(h,y,y);var g=a(y,Y);t.defined(g)&&(l=Math.min(l,g.x),c=Math.max(c,g.x),p=Math.min(p,g.y),d=Math.max(d,g.y))}return s.x=l,s.y=p,s.width=c-l,s.height=d-p,s},O.createGeometryFromPositions=function(e,t,a,i,n,o){var u=w.triangulate(t.positions2D,t.holes);u.length<3&&(u=[0,1,2]);var l=t.positions;if(i){for(var p=l.length,d=new Array(3*p),f=0,y=0;y<p;y++){var C=l[y];d[f++]=C.x,d[f++]=C.y,d[f++]=C.z}var g=new h.Geometry({attributes:{position:new h.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:u,primitiveType:m.PrimitiveType.TRIANGLES});return n.normal?c.GeometryPipeline.computeNormal(g):g}return o===r.ArcType.GEODESIC?w.computeSubdivision(e,l,u,a):o===r.ArcType.RHUMB?w.computeRhumbLineSubdivision(e,l,u,a):void 0};var X=[],Z=new n.Cartesian3,$=new n.Cartesian3;O.computeWallGeometry=function(e,t,a,i,o){var u,c,f,y,C,g=e.length,v=0;if(i)for(c=3*g*2,u=new Array(2*c),f=0;f<g;f++)y=e[f],C=e[(f+1)%g],u[v]=u[v+c]=y.x,u[++v]=u[v+c]=y.y,u[++v]=u[v+c]=y.z,u[++v]=u[v+c]=C.x,u[++v]=u[v+c]=C.y,u[++v]=u[v+c]=C.z,++v;else{var b=d.CesiumMath.chordLength(a,t.maximumRadius),E=0;if(o===r.ArcType.GEODESIC)for(f=0;f<g;f++)E+=O.subdivideLineCount(e[f],e[(f+1)%g],b);else if(o===r.ArcType.RHUMB)for(f=0;f<g;f++)E+=O.subdivideRhumbLineCount(t,e[f],e[(f+1)%g],b);for(c=3*(E+g),u=new Array(2*c),f=0;f<g;f++){var w;y=e[f],C=e[(f+1)%g],o===r.ArcType.GEODESIC?w=O.subdivideLine(y,C,b,X):o===r.ArcType.RHUMB&&(w=O.subdivideRhumbLine(t,y,C,b,X));for(var x=w.length,M=0;M<x;++M,++v)u[v]=w[M],u[v+c]=w[M];u[v]=C.x,u[v+c]=C.x,u[++v]=C.y,u[v+c]=C.y,u[++v]=C.z,u[v+c]=C.z,++v}}g=u.length;var T=p.IndexDatatype.createTypedArray(g/3,g-6*e.length),S=0;for(g/=6,f=0;f<g;f++){var A=f,I=A+1,L=A+g,G=L+1;y=n.Cartesian3.fromArray(u,3*A,Z),C=n.Cartesian3.fromArray(u,3*I,$),n.Cartesian3.equalsEpsilon(y,C,d.CesiumMath.EPSILON10,d.CesiumMath.EPSILON10)||(T[S++]=A,T[S++]=L,T[S++]=I,T[S++]=I,T[S++]=L,T[S++]=G)}return new h.Geometry({attributes:new l.GeometryAttributes({position:new h.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:u})}),indices:T,primitiveType:m.PrimitiveType.TRIANGLES})},e.GeometryInstance=function(e){e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT),this.geometry=e.geometry,this.modelMatrix=i.Matrix4.clone(t.defaultValue(e.modelMatrix,i.Matrix4.IDENTITY)),this.id=e.id,this.pickPrimitive=e.pickPrimitive,this.attributes=t.defaultValue(e.attributes,{}),this.westHemisphereGeometry=void 0,this.eastHemisphereGeometry=void 0},e.PolygonGeometryLibrary=O,e.PolygonPipeline=w,e.WindingOrder=v}));
