define(["./AttributeCompression-cd5fdf14","./EllipsoidTangentPlane-d397ceb5","./buildModuleUrl-9a89655b","./Cartesian2-99e64452","./Cartesian4-69ef58e5","./Cartographic-00721f3e","./when-b60132fc","./TerrainEncoding-3bbf84ba","./IndexDatatype-d62ee188","./Math-119be1a3","./OrientedBoundingBox-43298817","./Check-7b2a090c","./Transforms-f4127659","./WebMercatorProjection-2013e020","./createTaskProcessorWorker","./Plane-622eaee2","./WebGLConstants-aba9fc67","./FeatureDetection-ab6f364c"],(function(e,t,r,n,i,o,a,s,d,c,u,h,l,I,m,g,f,T){"use strict";function p(){h.DeveloperError.throwInstantiationError()}Object.defineProperties(p.prototype,{errorEvent:{get:h.DeveloperError.throwInstantiationError},credit:{get:h.DeveloperError.throwInstantiationError},tilingScheme:{get:h.DeveloperError.throwInstantiationError},ready:{get:h.DeveloperError.throwInstantiationError},readyPromise:{get:h.DeveloperError.throwInstantiationError},hasWaterMask:{get:h.DeveloperError.throwInstantiationError},hasVertexNormals:{get:h.DeveloperError.throwInstantiationError},availability:{get:h.DeveloperError.throwInstantiationError}});var v=[];p.getRegularGridIndices=function(e,t){var r=v[e];a.defined(r)||(v[e]=r=[]);var n=r[t];return a.defined(n)||N(e,t,n=e*t<c.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6+3*(e+t-2)):r[t]=new Uint32Array((e-1)*(t-1)*6+3*(e+t-2)),0),n},p.getRegularGridIndicesForReproject=function(e,t){var r=v[e];a.defined(r)||(v[e]=r=[]);var n=r[t];return a.defined(n)||N(e,t,n=e*t<c.CesiumMath.SIXTY_FOUR_KILOBYTES?r[t]=new Uint16Array((e-1)*(t-1)*6):r[t]=new Uint32Array((e-1)*(t-1)*6),0),n};var E=[];p.getRegularGridIndicesAndEdgeIndices=function(e,t){var r=E[e];a.defined(r)||(E[e]=r=[]);var n=r[t];if(!a.defined(n)){var i=p.getRegularGridIndices(e,t),o=w(e,t),s=o.westIndicesSouthToNorth,d=o.southIndicesEastToWest,c=o.eastIndicesNorthToSouth,u=o.northIndicesWestToEast;n=r[t]={indices:i,westIndicesSouthToNorth:s,southIndicesEastToWest:d,eastIndicesNorthToSouth:c,northIndicesWestToEast:u}}return n};var y=[];function w(e,t){var r,n=new Array(t),i=new Array(e),o=new Array(t),a=new Array(e);for(r=0;r<e;++r)a[r]=r,i[r]=e*t-1-r;for(r=0;r<t;++r)o[r]=(r+1)*e-1,n[r]=(t-r-1)*e;return{westIndicesSouthToNorth:n,southIndicesEastToWest:i,eastIndicesNorthToSouth:o,northIndicesWestToEast:a}}function N(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i,d=s+e,c=d+1,u=s+1;r[n++]=s,r[n++]=d,r[n++]=u,r[n++]=u,r[n++]=d,r[n++]=c,++i}++i}var h=(t-1)/2,l=(e-1)/2;i=0;for(a=0;a<l;a++)r[n++]=i,r[n++]=i+1,r[n++]=i+2,i+=2;i=e*(t-1);for(a=0;a<l;a++)r[n++]=i+1,r[n++]=i,r[n++]=i+2,i+=2;i=0;for(a=0;a<h;a++)r[n++]=i+e,r[n++]=i,r[n++]=i+2*e,i+=2*e;i=e-1;for(a=0;a<h;a++)r[n++]=i,r[n++]=i+e,r[n++]=i+2*e,i+=2*e}function x(e,t,r,n,i){for(var o=a.defined(i),s=e[0],d=e.length,c=1;c<d;++c){var u=e[c];!o||i[s+"_"+u]?(r[n++]=s,r[n++]=u,r[n++]=t,r[n++]=t,r[n++]=u,r[n++]=t+1,s=u,++t):(s=u,++t)}return n}p.getRegularGridAndSkirtIndicesAndEdgeIndices=function(e,t){var r=y[e];a.defined(r)||(y[e]=r=[]);var n=r[t];if(!a.defined(n)){var i=e*t,o=(e-1)*(t-1)*6,s=2*e+2*t,c=i+s,u=3*(e+t-2),h=o+6*Math.max(0,s-4)+u,l=w(e,t),I=l.westIndicesSouthToNorth,m=l.southIndicesEastToWest,g=l.eastIndicesNorthToSouth,f=l.northIndicesWestToEast,T=d.IndexDatatype.createTypedArray(c,h);N(e,t,T,0),p.addSkirtIndices(I,m,g,f,i,T,o+u),n=r[t]={indices:T,westIndicesSouthToNorth:I,southIndicesEastToWest:m,eastIndicesNorthToSouth:g,northIndicesWestToEast:f,indexCountWithoutSkirts:o}}return n},p.addSkirtIndices=function(e,t,r,n,i,o,a,s){var d=i;a=x(e,d,o,a,s),a=x(t,d+=e.length,o,a,s),a=x(r,d+=t.length,o,a,s),x(n,d+=r.length,o,a,s)},p.heightmapTerrainQuality=.25,p.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*p.heightmapTerrainQuality/(t*r)},p.prototype.requestTileGeometry=h.DeveloperError.throwInstantiationError,p.prototype.getLevelMaximumGeometricError=h.DeveloperError.throwInstantiationError,p.prototype.getTileDataAvailable=h.DeveloperError.throwInstantiationError,p.prototype.loadTileDataAvailability=h.DeveloperError.throwInstantiationError;var M=32767,b=new i.Cartesian3,C=new i.Cartesian3,S=new i.Cartesian3,A=new o.Cartographic,P=new n.Cartesian2,W=new i.Cartesian3,_=new n.Matrix4,F=new n.Matrix4;function B(e,t,r,o,a,s,d,u,h){var l=Number.POSITIVE_INFINITY,I=a.north,m=a.south,g=a.east,f=a.west;g<f&&(g+=c.CesiumMath.TWO_PI);for(var T=e.length,p=0;p<T;++p){var v=e[p],E=r[v],y=o[v];A.longitude=c.CesiumMath.lerp(f,g,y.x),A.latitude=c.CesiumMath.lerp(m,I,y.y),A.height=E-t;var w=s.cartographicToCartesian(A,b);n.Matrix4.multiplyByPoint(d,w,w),i.Cartesian3.minimumByComponent(w,u,u),i.Cartesian3.maximumByComponent(w,h,h),l=Math.min(l,A.height)}return l}function D(t,r,o,s,d,u,h,m,g,f,T,p,v,E,y){var w=a.defined(h),N=g.north,x=g.south,M=g.east,C=g.west;M<C&&(M+=c.CesiumMath.TWO_PI);for(var S=o.length,B=0;B<S;++B){var D=o[B],k=d[D],V=u[D];A.longitude=c.CesiumMath.lerp(C,M,V.x)+E,A.latitude=c.CesiumMath.lerp(x,N,V.y)+y,A.height=k-f;var O,Y=m.cartographicToCartesian(A,b);if(w){var G=2*D;if(P.x=h[G],P.y=h[G+1],1!==T){var H=e.AttributeCompression.octDecode(P.x,P.y,W),R=l.Transforms.eastNorthUpToFixedFrame(b,m,F),U=n.Matrix4.inverseTransformation(R,_);n.Matrix4.multiplyByPointAsVector(U,H,H),H.z*=T,i.Cartesian3.normalize(H,H),n.Matrix4.multiplyByPointAsVector(R,H,H),i.Cartesian3.normalize(H,H),e.AttributeCompression.octEncode(H,P)}}s.hasWebMercatorT&&(O=(I.WebMercatorProjection.geodeticLatitudeToMercatorAngle(A.latitude)-p)*v),r=s.encode(t,r,Y,V,A.height,P,O)}}function k(e,t){var r;return"function"==typeof e.slice&&"function"!=typeof(r=e.slice()).sort&&(r=void 0),a.defined(r)||(r=Array.prototype.slice.call(e)),r.sort(t),r}return m((function(o,h){var m,g,f=o.quantizedVertices,T=f.length/3,v=o.octEncodedNormals,E=o.westIndices.length+o.eastIndices.length+o.southIndices.length+o.northIndices.length,y=o.includeWebMercatorT,w=r.Rectangle.clone(o.rectangle),N=w.west,x=w.south,V=w.east,O=w.north,Y=r.Ellipsoid.clone(o.ellipsoid),G=o.exaggeration,H=o.minimumHeight*G,R=o.maximumHeight*G,U=o.relativeToCenter,z=l.Transforms.eastNorthUpToFixedFrame(U,Y),L=n.Matrix4.inverseTransformation(z,new n.Matrix4);y&&(m=I.WebMercatorProjection.geodeticLatitudeToMercatorAngle(x),g=1/(I.WebMercatorProjection.geodeticLatitudeToMercatorAngle(O)-m));var j=f.subarray(0,T),q=f.subarray(T,2*T),K=f.subarray(2*T,3*T),Q=a.defined(v),X=new Array(T),Z=new Array(T),J=new Array(T),$=y?new Array(T):[],ee=C;ee.x=Number.POSITIVE_INFINITY,ee.y=Number.POSITIVE_INFINITY,ee.z=Number.POSITIVE_INFINITY;var te=S;te.x=Number.NEGATIVE_INFINITY,te.y=Number.NEGATIVE_INFINITY,te.z=Number.NEGATIVE_INFINITY;for(var re=Number.POSITIVE_INFINITY,ne=Number.NEGATIVE_INFINITY,ie=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY,ae=0;ae<T;++ae){var se=j[ae],de=q[ae],ce=se/M,ue=de/M,he=c.CesiumMath.lerp(H,R,K[ae]/M);A.longitude=c.CesiumMath.lerp(N,V,ce),A.latitude=c.CesiumMath.lerp(x,O,ue),A.height=he,re=Math.min(A.longitude,re),ne=Math.max(A.longitude,ne),ie=Math.min(A.latitude,ie),oe=Math.max(A.latitude,oe);var le=Y.cartographicToCartesian(A);X[ae]=new n.Cartesian2(ce,ue),Z[ae]=he,J[ae]=le,y&&($[ae]=(I.WebMercatorProjection.geodeticLatitudeToMercatorAngle(A.latitude)-m)*g),n.Matrix4.multiplyByPoint(L,le,b),i.Cartesian3.minimumByComponent(b,ee,ee),i.Cartesian3.maximumByComponent(b,te,te)}var Ie,me,ge,fe=k(o.westIndices,(function(e,t){return X[e].y-X[t].y})),Te=k(o.eastIndices,(function(e,t){return X[t].y-X[e].y})),pe=k(o.southIndices,(function(e,t){return X[t].x-X[e].x})),ve=k(o.northIndices,(function(e,t){return X[e].x-X[t].x}));me=r.BoundingSphere.fromPoints(J),Ie=u.OrientedBoundingBox.fromRectangle(w,H,R,Y),(1!==G||H<0)&&(ge=new s.EllipsoidalOccluder(Y).computeHorizonCullingPointPossiblyUnderEllipsoid(U,J,H));var Ee=H;Ee=Math.min(Ee,B(o.westIndices,o.westSkirtHeight,Z,X,w,Y,L,ee,te)),Ee=Math.min(Ee,B(o.southIndices,o.southSkirtHeight,Z,X,w,Y,L,ee,te)),Ee=Math.min(Ee,B(o.eastIndices,o.eastSkirtHeight,Z,X,w,Y,L,ee,te)),Ee=Math.min(Ee,B(o.northIndices,o.northSkirtHeight,Z,X,w,Y,L,ee,te));for(var ye=new t.AxisAlignedBoundingBox(ee,te,U),we=new s.TerrainEncoding(ye,Ee,R,z,Q,y),Ne=we.getStride(),xe=new Float32Array(T*Ne+E*Ne),Me=0,be=0;be<T;++be){if(Q){var Ce=2*be;if(P.x=v[Ce],P.y=v[Ce+1],1!==G){var Se=e.AttributeCompression.octDecode(P.x,P.y,W),Ae=l.Transforms.eastNorthUpToFixedFrame(J[be],Y,F),Pe=n.Matrix4.inverseTransformation(Ae,_);n.Matrix4.multiplyByPointAsVector(Pe,Se,Se),Se.z*=G,i.Cartesian3.normalize(Se,Se),n.Matrix4.multiplyByPointAsVector(Ae,Se,Se),i.Cartesian3.normalize(Se,Se),e.AttributeCompression.octEncode(Se,P)}}Me=we.encode(xe,Me,J[be],X[be],Z[be],P,$[be])}var We=Math.max(0,2*(E-4)),_e=o.indices.length+3*We,Fe=d.IndexDatatype.createTypedArray(T+E,_e);Fe.set(o.indices,0);var Be=1e-4,De=(ne-re)*Be,ke=(oe-ie)*Be,Ve=-De,Oe=De,Ye=ke,Ge=-ke,He=T*Ne;D(xe,He,fe,we,Z,X,v,Y,w,o.westSkirtHeight,G,m,g,Ve,0),D(xe,He+=o.westIndices.length*Ne,pe,we,Z,X,v,Y,w,o.southSkirtHeight,G,m,g,0,Ge),D(xe,He+=o.southIndices.length*Ne,Te,we,Z,X,v,Y,w,o.eastSkirtHeight,G,m,g,Oe,0),D(xe,He+=o.eastIndices.length*Ne,ve,we,Z,X,v,Y,w,o.northSkirtHeight,G,m,g,0,Ye);var Re=function(e,t,r,n){if(n<12)return;for(var i={},o=e.length,a=0;a<o;a+=3){var s=e[a],d=e[a+1],c=e[a+2];(t[s]===M&&t[d]===M||0===t[s]&&0===t[d]||r[s]===M&&r[d]===M||0===r[s]&&0===r[d])&&(i[s+"_"+d]=1,i[d+"_"+s]=1),(t[d]===M&&t[c]===M||0===t[d]&&0===t[c]||r[d]===M&&r[c]===M||0===r[d]&&0===r[c])&&(i[d+"_"+c]=1,i[c+"_"+d]=1),(t[c]===M&&t[s]===M||0===t[c]&&0===t[s]||r[c]===M&&r[s]===M||0===r[c]&&0===r[s])&&(i[c+"_"+s]=1,i[s+"_"+c]=1)}return i}(o.indices,j,q,o.level);return p.addSkirtIndices(fe,pe,Te,ve,T,Fe,o.indices.length,Re),h.push(xe.buffer,Fe.buffer),{vertices:xe.buffer,indices:Fe.buffer,westIndicesSouthToNorth:fe,southIndicesEastToWest:pe,eastIndicesNorthToSouth:Te,northIndicesWestToEast:ve,vertexStride:Ne,center:U,minimumHeight:H,maximumHeight:R,boundingSphere:me,orientedBoundingBox:Ie,occludeePointInScaledSpace:ge,encoding:we,indexCountWithoutSkirts:o.indices.length}}))}));
