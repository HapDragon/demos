define(["./AttributeCompression-cd5fdf14","./buildModuleUrl-9a89655b","./Cartesian2-99e64452","./Cartesian4-69ef58e5","./Cartographic-00721f3e","./when-b60132fc","./TerrainEncoding-3bbf84ba","./IndexDatatype-d62ee188","./Check-7b2a090c","./Math-119be1a3","./OrientedBoundingBox-43298817","./createTaskProcessorWorker","./WebGLConstants-aba9fc67","./FeatureDetection-ab6f364c","./EllipsoidTangentPlane-d397ceb5","./Plane-622eaee2","./Transforms-f4127659"],(function(e,t,i,n,s,r,h,u,o,a,p,d,f,l,g,c,m){"use strict";var x={clipTriangleAtAxisAlignedThreshold:function(e,t,i,n,s,h){var u,o,a;r.defined(h)?h.length=0:h=[],t?(u=i<e,o=n<e,a=s<e):(u=i>e,o=n>e,a=s>e);var p,d,f,l,g,c,m=u+o+a;return 1===m?u?(p=(e-i)/(n-i),d=(e-i)/(s-i),h.push(1),h.push(2),1!==d&&(h.push(-1),h.push(0),h.push(2),h.push(d)),1!==p&&(h.push(-1),h.push(0),h.push(1),h.push(p))):o?(f=(e-n)/(s-n),l=(e-n)/(i-n),h.push(2),h.push(0),1!==l&&(h.push(-1),h.push(1),h.push(0),h.push(l)),1!==f&&(h.push(-1),h.push(1),h.push(2),h.push(f))):a&&(g=(e-s)/(i-s),c=(e-s)/(n-s),h.push(0),h.push(1),1!==c&&(h.push(-1),h.push(2),h.push(1),h.push(c)),1!==g&&(h.push(-1),h.push(2),h.push(0),h.push(g))):2===m?u||i===e?o||n===e?a||s===e||(d=(e-i)/(s-i),f=(e-n)/(s-n),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(d),h.push(-1),h.push(1),h.push(2),h.push(f)):(c=(e-s)/(n-s),p=(e-i)/(n-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(c),h.push(-1),h.push(0),h.push(1),h.push(p)):(l=(e-n)/(i-n),g=(e-s)/(i-s),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(l),h.push(-1),h.push(2),h.push(0),h.push(g)):3!==m&&(h.push(0),h.push(1),h.push(2)),h},computeBarycentricCoordinates:function(e,t,i,s,h,u,o,a,p){var d=i-o,f=o-h,l=u-a,g=s-a,c=1/(l*d+f*g),m=t-a,x=e-o,v=(l*x+f*m)*c,C=(-g*x+d*m)*c,w=1-v-C;return r.defined(p)?(p.x=v,p.y=C,p.z=w,p):new n.Cartesian3(v,C,w)},computeLineSegmentLineSegmentIntersection:function(e,t,n,s,h,u,o,a,p){var d=(a-u)*(n-e)-(o-h)*(s-t);if(0!==d){var f=((o-h)*(t-u)-(a-u)*(e-h))/d,l=((n-e)*(t-u)-(s-t)*(e-h))/d;return f>=0&&f<=1&&l>=0&&l<=1?(r.defined(p)||(p=new i.Cartesian2),p.x=e+f*(n-e),p.y=t+f*(s-t),p):void 0}}},v=32767,C=16383,w=[],y=[],B=[],b=new s.Cartographic,I=new n.Cartesian3,A=[],T=[],z=[],M=[],N=[],V=new n.Cartesian3,H=new t.BoundingSphere,E=new p.OrientedBoundingBox,R=new i.Cartesian2,O=new n.Cartesian3;function U(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}U.prototype.clone=function(e){return r.defined(e)||(e=new U),e.uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},U.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},U.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},U.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},U.prototype.isIndexed=function(){return r.defined(this.index)},U.prototype.getH=function(e,t){if(r.defined(this.index))return this.heightBuffer[this.index];var i=this.first.getH(e,t),n=this.second.getH(e,t);return 0===t+i/v*e||0===t+n/v*e?0:a.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},U.prototype.getU=function(){return r.defined(this.index)?this.uBuffer[this.index]:a.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},U.prototype.getV=function(){return r.defined(this.index)?this.vBuffer[this.index]:a.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var F=new i.Cartesian2,S=-1,P=[new n.Cartesian3,new n.Cartesian3],k=[new n.Cartesian3,new n.Cartesian3];function D(t,i){++S;var s=P[S],r=k[S];return s=e.AttributeCompression.octDecode(t.first.getNormalX(),t.first.getNormalY(),s),r=e.AttributeCompression.octDecode(t.second.getNormalX(),t.second.getNormalY(),r),I=n.Cartesian3.lerp(s,r,t.ratio,I),n.Cartesian3.normalize(I,I),e.AttributeCompression.octEncode(I,i),--S,i}U.prototype.getNormalX=function(){return r.defined(this.index)?this.normalBuffer[2*this.index]:(F=D(this,F)).x},U.prototype.getNormalY=function(){return r.defined(this.index)?this.normalBuffer[2*this.index+1]:(F=D(this,F)).y};var W=[];function X(e,t,i,n,s,h,u,o,a,p,d){if(0!==u.length){for(var f=0,l=0;l<u.length;)l=W[f++].initializeFromClipResult(u,l,o);for(var g=0;g<f;++g){var c=W[g];if(c.isIndexed())c.newIndex=h[c.index],c.uBuffer=e,c.vBuffer=t,c.heightBuffer=i,a&&(c.normalBuffer=n);else{var m=c.getKey();if(r.defined(h[m]))c.newIndex=h[m];else{var x=e.length;e.push(c.getU()),t.push(c.getV()),i.push(c.getH(p,d)),a&&(n.push(c.getNormalX()),n.push(c.getNormalY())),c.newIndex=x,h[m]=x}}}3===f?(s.push(W[0].newIndex),s.push(W[1].newIndex),s.push(W[2].newIndex)):4===f&&(s.push(W[0].newIndex),s.push(W[1].newIndex),s.push(W[2].newIndex),s.push(W[0].newIndex),s.push(W[2].newIndex),s.push(W[3].newIndex))}}return W.push(new U),W.push(new U),W.push(new U),W.push(new U),d((function(e,i){var s=e.isEastChild,r=e.isNorthChild,o=s?C:0,d=s?v:C,f=r?C:0,l=r?v:C,g=A,c=T,m=z,F=N;g.length=0,c.length=0,m.length=0,F.length=0;var S=M;S.length=0;var P={},k=e.vertices,D=e.indices;D=D.subarray(0,e.indexCountWithoutSkirts);var W,K,L,Y,_,G=h.TerrainEncoding.clone(e.encoding),J=G.hasVertexNormals,Z=e.exaggeration,j=0,q=e.vertexCountWithoutSkirts,Q=e.minimumHeight,$=e.maximumHeight,ee=new Array(q),te=new Array(q),ie=new Array(q),ne=J?new Array(2*q):void 0;for(K=0,L=0;K<q;++K,L+=2){var se=G.decodeTextureCoordinates(k,K,R);if(W=G.decodeHeight(k,K)/Z,Y=a.CesiumMath.clamp(se.x*v|0,0,v),_=a.CesiumMath.clamp(se.y*v|0,0,v),ie[K]=a.CesiumMath.clamp((W-Q)/($-Q)*v|0,0,v),Y<20&&(Y=0),_<20&&(_=0),v-Y<20&&(Y=v),v-_<20&&(_=v),ee[K]=Y,te[K]=_,J){var re=G.getOctEncodedNormal(k,K,O);ne[L]=re.x,ne[L+1]=re.y}(s&&Y>=C||!s&&Y<=C)&&(r&&_>=C||!r&&_<=C)&&(P[K]=j,g.push(Y),c.push(_),m.push(ie[K]),J&&(F.push(ne[L]),F.push(ne[L+1])),++j)}var he=[];he.push(new U),he.push(new U),he.push(new U);var ue,oe=[];for(oe.push(new U),oe.push(new U),oe.push(new U),K=0;K<D.length;K+=3){var ae=D[K],pe=D[K+1],de=D[K+2],fe=ee[ae],le=ee[pe],ge=ee[de];he[0].initializeIndexed(ee,te,ie,ne,ae),he[1].initializeIndexed(ee,te,ie,ne,pe),he[2].initializeIndexed(ee,te,ie,ne,de);var ce=x.clipTriangleAtAxisAlignedThreshold(C,s,fe,le,ge,w);(ue=0)>=ce.length||((ue=oe[0].initializeFromClipResult(ce,ue,he))>=ce.length||(ue=oe[1].initializeFromClipResult(ce,ue,he))>=ce.length||(ue=oe[2].initializeFromClipResult(ce,ue,he),X(g,c,m,F,S,P,x.clipTriangleAtAxisAlignedThreshold(C,r,oe[0].getV(),oe[1].getV(),oe[2].getV(),y),oe,J,$,Q),ue<ce.length&&(oe[2].clone(oe[1]),oe[2].initializeFromClipResult(ce,ue,he),X(g,c,m,F,S,P,x.clipTriangleAtAxisAlignedThreshold(C,r,oe[0].getV(),oe[1].getV(),oe[2].getV(),y),oe,J,$,Q))))}var me=s?-32767:0,xe=r?-32767:0,ve=[],Ce=[],we=[],ye=[],Be=Number.MAX_VALUE,be=-Be,Ie=B;Ie.length=0;var Ae=t.Ellipsoid.clone(e.ellipsoid),Te=t.Rectangle.clone(e.childRectangle),ze=Te.north,Me=Te.south,Ne=Te.east,Ve=Te.west;for(Ne<Ve&&(Ne+=a.CesiumMath.TWO_PI),K=0;K<g.length;++K)(Y=Math.round(g[K]))<=o?(ve.push(K),Y=0):Y>=d?(we.push(K),Y=v):Y=2*Y+me,g[K]=Y,(_=Math.round(c[K]))<=f?(Ce.push(K),_=0):_>=l?(ye.push(K),_=v):_=2*_+xe,c[K]=_,(W=a.CesiumMath.lerp(Q,$,m[K]/v))<Be&&(Be=W),W>be&&(be=W),m[K]=W,b.longitude=a.CesiumMath.lerp(Ve,Ne,Y/v),b.latitude=a.CesiumMath.lerp(Me,ze,_/v),b.height=W,Ae.cartographicToCartesian(b,I),Ie.push(I.x),Ie.push(I.y),Ie.push(I.z);var He=t.BoundingSphere.fromVertices(Ie,n.Cartesian3.ZERO,3,H),Ee=p.OrientedBoundingBox.fromRectangle(Te,Be,be,Ae,E),Re=new h.EllipsoidalOccluder(Ae).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(He.center,Ie,3,He.center,Be,V),Oe=be-Be,Ue=new Uint16Array(g.length+c.length+m.length);for(K=0;K<g.length;++K)Ue[K]=g[K];var Fe=g.length;for(K=0;K<c.length;++K)Ue[Fe+K]=c[K];for(Fe+=c.length,K=0;K<m.length;++K)Ue[Fe+K]=v*(m[K]-Be)/Oe;var Se,Pe=u.IndexDatatype.createTypedArray(g.length,S);if(J){var ke=new Uint8Array(F);i.push(Ue.buffer,Pe.buffer,ke.buffer),Se=ke.buffer}else i.push(Ue.buffer,Pe.buffer);return{vertices:Ue.buffer,encodedNormals:Se,indices:Pe.buffer,minimumHeight:Be,maximumHeight:be,westIndices:ve,southIndices:Ce,eastIndices:we,northIndices:ye,boundingSphere:He,orientedBoundingBox:Ee,horizonOcclusionPoint:Re}}))}));
