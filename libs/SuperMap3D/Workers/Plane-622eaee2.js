define(["exports","./Cartesian4-69ef58e5","./Cartographic-00721f3e","./when-b60132fc","./Check-7b2a090c","./buildModuleUrl-9a89655b","./Math-119be1a3","./Cartesian2-99e64452"],(function(a,t,e,r,n,i,s,o){"use strict";var u={};function c(a,t,e){var r=a+t;return s.CesiumMath.sign(a)!==s.CesiumMath.sign(t)&&Math.abs(r/Math.max(Math.abs(a),Math.abs(t)))<e?0:r}u.computeDiscriminant=function(a,t,e){return t*t-4*a*e},u.computeRealRoots=function(a,t,e){var r;if(0===a)return 0===t?[]:[-e/t];if(0===t){if(0===e)return[0,0];var n=Math.abs(e),i=Math.abs(a);if(n<i&&n/i<s.CesiumMath.EPSILON14)return[0,0];if(n>i&&i/n<s.CesiumMath.EPSILON14)return[];if((r=-e/a)<0)return[];var o=Math.sqrt(r);return[-o,o]}if(0===e)return(r=-t/a)<0?[r,0]:[0,r];var u=c(t*t,-(4*a*e),s.CesiumMath.EPSILON14);if(u<0)return[];var l=-.5*c(t,s.CesiumMath.sign(t)*Math.sqrt(u),s.CesiumMath.EPSILON14);return t>0?[l/a,e/l]:[e/l,l/a]};var l={};function C(a,t,e,r){var n,i,s=a,o=t/3,u=e/3,c=r,l=s*u,C=o*c,m=o*o,f=u*u,d=s*u-m,h=s*c-o*u,M=o*c-f,v=4*d*M-h*h;if(v<0){var g,p,w;m*C>=l*f?(g=s,p=d,w=-2*o*d+s*h):(g=c,p=M,w=-c*h+2*u*M);var R=-(w<0?-1:1)*Math.abs(g)*Math.sqrt(-v),O=(i=-w+R)/2,S=O<0?-Math.pow(-O,1/3):Math.pow(O,1/3),P=i===R?-S:-p/S;return n=p<=0?S+P:-w/(S*S+P*P+p),m*C>=l*f?[(n-o)/s]:[-c/(n+u)]}var y=d,x=-2*o*d+s*h,N=M,b=-c*h+2*u*M,I=Math.sqrt(v),q=Math.sqrt(3)/2,L=Math.abs(Math.atan2(s*I,-x)/3);n=2*Math.sqrt(-y);var E=Math.cos(L);i=n*E;var z=n*(-E/2-q*Math.sin(L)),T=i+z>2*o?i-o:z-o,U=s,B=T/U;L=Math.abs(Math.atan2(c*I,-b)/3);var W=-c,_=(i=(n=2*Math.sqrt(-N))*(E=Math.cos(L)))+(z=n*(-E/2-q*Math.sin(L)))<2*u?i+u:z+u,V=W/_,Z=-T*_-U*W,A=(u*Z-o*(T*W))/(-o*Z+u*(U*_));return B<=A?B<=V?A<=V?[B,A,V]:[B,V,A]:[V,B,A]:B<=V?[A,B,V]:A<=V?[A,V,B]:[V,A,B]}l.computeDiscriminant=function(a,t,e,r){var n=t*t,i=e*e;return 18*a*t*e*r+n*i-27*(a*a)*(r*r)-4*(a*i*e+n*t*r)},l.computeRealRoots=function(a,t,e,r){var n,i;if(0===a)return u.computeRealRoots(t,e,r);if(0===t){if(0===e){if(0===r)return[0,0,0];var s=(i=-r/a)<0?-Math.pow(-i,1/3):Math.pow(i,1/3);return[s,s,s]}return 0===r?0===(n=u.computeRealRoots(a,0,e)).Length?[0]:[n[0],0,n[1]]:C(a,0,e,r)}return 0===e?0===r?(i=-t/a)<0?[i,0,0]:[0,0,i]:C(a,t,0,r):0===r?0===(n=u.computeRealRoots(a,t,e)).length?[0]:n[1]<=0?[n[0],n[1],0]:n[0]>=0?[0,n[0],n[1]]:[n[0],0,n[1]]:C(a,t,e,r)};var m={};function f(a,t,e,r){var n=a*a,i=t-3*n/8,o=e-t*a/2+n*a/8,c=r-e*a/4+t*n/16-3*n*n/256,C=l.computeRealRoots(1,2*i,i*i-4*c,-o*o);if(C.length>0){var m=-a/4,f=C[C.length-1];if(Math.abs(f)<s.CesiumMath.EPSILON14){var d=u.computeRealRoots(1,i,c);if(2===d.length){var h,M=d[0],v=d[1];if(M>=0&&v>=0){var g=Math.sqrt(M),p=Math.sqrt(v);return[m-p,m-g,m+g,m+p]}if(M>=0&&v<0)return[m-(h=Math.sqrt(M)),m+h];if(M<0&&v>=0)return[m-(h=Math.sqrt(v)),m+h]}return[]}if(f>0){var w=Math.sqrt(f),R=(i+f-o/w)/2,O=(i+f+o/w)/2,S=u.computeRealRoots(1,w,R),P=u.computeRealRoots(1,-w,O);return 0!==S.length?(S[0]+=m,S[1]+=m,0!==P.length?(P[0]+=m,P[1]+=m,S[1]<=P[0]?[S[0],S[1],P[0],P[1]]:P[1]<=S[0]?[P[0],P[1],S[0],S[1]]:S[0]>=P[0]&&S[1]<=P[1]?[P[0],S[0],S[1],P[1]]:P[0]>=S[0]&&P[1]<=S[1]?[S[0],P[0],P[1],S[1]]:S[0]>P[0]&&S[0]<P[1]?[P[0],S[0],P[1],S[1]]:[S[0],P[0],S[1],P[1]]):S):0!==P.length?(P[0]+=m,P[1]+=m,P):[]}}return[]}function d(a,t,e,r){var n=a*a,i=-2*t,o=e*a+t*t-4*r,c=n*r-e*t*a+e*e,C=l.computeRealRoots(1,i,o,c);if(C.length>0){var m,f,d,h,M,v,g=C[0],p=t-g,w=p*p,R=a/2,O=p/2,S=w-4*r,P=w+4*Math.abs(r),y=n-4*g,x=n+4*Math.abs(g);if(g<0||S*x<y*P){var N=Math.sqrt(y);m=N/2,f=0===N?0:(a*O-e)/N}else{var b=Math.sqrt(S);m=0===b?0:(a*O-e)/b,f=b/2}0===R&&0===m?(d=0,h=0):s.CesiumMath.sign(R)===s.CesiumMath.sign(m)?h=g/(d=R+m):d=g/(h=R-m),0===O&&0===f?(M=0,v=0):s.CesiumMath.sign(O)===s.CesiumMath.sign(f)?v=r/(M=O+f):M=r/(v=O-f);var I=u.computeRealRoots(1,d,M),q=u.computeRealRoots(1,h,v);if(0!==I.length)return 0!==q.length?I[1]<=q[0]?[I[0],I[1],q[0],q[1]]:q[1]<=I[0]?[q[0],q[1],I[0],I[1]]:I[0]>=q[0]&&I[1]<=q[1]?[q[0],I[0],I[1],q[1]]:q[0]>=I[0]&&q[1]<=I[1]?[I[0],q[0],q[1],I[1]]:I[0]>q[0]&&I[0]<q[1]?[q[0],I[0],q[1],I[1]]:[I[0],q[0],I[1],q[1]]:I;if(0!==q.length)return q}return[]}function h(a,e){e=t.Cartesian3.clone(r.defaultValue(e,t.Cartesian3.ZERO)),t.Cartesian3.equals(e,t.Cartesian3.ZERO)||t.Cartesian3.normalize(e,e),this.origin=t.Cartesian3.clone(r.defaultValue(a,t.Cartesian3.ZERO)),this.direction=e}m.computeDiscriminant=function(a,t,e,r,n){var i=a*a,s=t*t,o=s*t,u=e*e,c=u*e,l=r*r,C=l*r,m=n*n;return s*u*l-4*o*C-4*a*c*l+18*a*t*e*C-27*i*l*l+256*(i*a)*(m*n)+n*(18*o*e*r-4*s*c+16*a*u*u-80*a*t*u*r-6*a*s*l+144*i*e*l)+m*(144*a*s*e-27*s*s-128*i*u-192*i*t*r)},m.computeRealRoots=function(a,t,e,r,n){if(Math.abs(a)<s.CesiumMath.EPSILON15)return l.computeRealRoots(t,e,r,n);var i=t/a,o=e/a,u=r/a,c=n/a,C=i<0?1:0;switch(C+=o<0?C+1:C,C+=u<0?C+1:C,C+=c<0?C+1:C){case 0:case 3:case 4:case 6:case 7:case 9:case 10:case 12:case 13:case 14:case 15:return f(i,o,u,c);case 1:case 2:case 5:case 8:case 11:return d(i,o,u,c);default:return}},h.clone=function(a,e){if(r.defined(a))return r.defined(e)?(e.origin=t.Cartesian3.clone(a.origin),e.direction=t.Cartesian3.clone(a.direction),e):new h(a.origin,a.direction)},h.getPoint=function(a,e,n){return r.defined(n)||(n=new t.Cartesian3),n=t.Cartesian3.multiplyByScalar(a.direction,e,n),t.Cartesian3.add(a.origin,n,n)};var M={rayPlane:function(a,e,n){r.defined(n)||(n=new t.Cartesian3);var i=a.origin,o=a.direction,u=e.normal,c=t.Cartesian3.dot(u,o);if(!(Math.abs(c)<s.CesiumMath.EPSILON15)){var l=(-e.distance-t.Cartesian3.dot(u,i))/c;if(!(l<0))return n=t.Cartesian3.multiplyByScalar(o,l,n),t.Cartesian3.add(i,n,n)}}},v=new t.Cartesian3,g=new t.Cartesian3,p=new t.Cartesian3,w=new t.Cartesian3,R=new t.Cartesian3;M.rayTriangleParametric=function(a,e,n,i,o){o=r.defaultValue(o,!1);var u,c,l,C,m,f=a.origin,d=a.direction,h=t.Cartesian3.subtract(n,e,v),M=t.Cartesian3.subtract(i,e,g),O=t.Cartesian3.cross(d,M,p),S=t.Cartesian3.dot(h,O);if(o){if(S<s.CesiumMath.EPSILON6)return;if(u=t.Cartesian3.subtract(f,e,w),(l=t.Cartesian3.dot(u,O))<0||l>S)return;if(c=t.Cartesian3.cross(u,h,R),(C=t.Cartesian3.dot(d,c))<0||l+C>S)return;m=t.Cartesian3.dot(M,c)/S}else{if(Math.abs(S)<s.CesiumMath.EPSILON6)return;var P=1/S;if(u=t.Cartesian3.subtract(f,e,w),(l=t.Cartesian3.dot(u,O)*P)<0||l>1)return;if(c=t.Cartesian3.cross(u,h,R),(C=t.Cartesian3.dot(d,c)*P)<0||l+C>1)return;m=t.Cartesian3.dot(M,c)*P}return m},M.rayTriangle=function(a,e,n,i,s,o){var u=M.rayTriangleParametric(a,e,n,i,s);if(r.defined(u)&&!(u<0))return r.defined(o)||(o=new t.Cartesian3),t.Cartesian3.multiplyByScalar(a.direction,u,o),t.Cartesian3.add(a.origin,o,o)};var O=new h;M.lineSegmentTriangle=function(a,e,n,i,s,o,u){var c=O;t.Cartesian3.clone(a,c.origin),t.Cartesian3.subtract(e,a,c.direction),t.Cartesian3.normalize(c.direction,c.direction);var l=M.rayTriangleParametric(c,n,i,s,o);if(!(!r.defined(l)||l<0||l>t.Cartesian3.distance(a,e)))return r.defined(u)||(u=new t.Cartesian3),t.Cartesian3.multiplyByScalar(c.direction,l,u),t.Cartesian3.add(c.origin,u,u)};var S={root0:0,root1:0};function P(a,e,n){r.defined(n)||(n=new i.Interval);var s=a.origin,o=a.direction,u=e.center,c=e.radius*e.radius,l=t.Cartesian3.subtract(s,u,p),C=function(a,t,e,r){var n=t*t-4*a*e;if(!(n<0)){if(n>0){var i=1/(2*a),s=Math.sqrt(n),o=(-t+s)*i,u=(-t-s)*i;return o<u?(r.root0=o,r.root1=u):(r.root0=u,r.root1=o),r}var c=-t/(2*a);if(0!==c)return r.root0=r.root1=c,r}}(t.Cartesian3.dot(o,o),2*t.Cartesian3.dot(o,l),t.Cartesian3.magnitudeSquared(l)-c,S);if(r.defined(C))return n.start=C.root0,n.stop=C.root1,n}M.raySphere=function(a,t,e){if(e=P(a,t,e),r.defined(e)&&!(e.stop<0))return e.start=Math.max(e.start,0),e};var y=new h;M.lineSegmentSphere=function(a,e,n,i){var s=y;t.Cartesian3.clone(a,s.origin);var o=t.Cartesian3.subtract(e,a,s.direction),u=t.Cartesian3.magnitude(o);if(t.Cartesian3.normalize(o,o),i=P(s,n,i),!(!r.defined(i)||i.stop<0||i.start>u))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,u),i};var x=new t.Cartesian3,N=new t.Cartesian3;function b(a,t,e){var r=a+t;return s.CesiumMath.sign(a)!==s.CesiumMath.sign(t)&&Math.abs(r/Math.max(Math.abs(a),Math.abs(t)))<e?0:r}M.rayEllipsoid=function(a,e){var r,n,s,o,u,c=e.oneOverRadii,l=t.Cartesian3.multiplyComponents(c,a.origin,x),C=t.Cartesian3.multiplyComponents(c,a.direction,N),m=t.Cartesian3.magnitudeSquared(l),f=t.Cartesian3.dot(l,C);if(m>1){if(f>=0)return;var d=f*f;if(r=m-1,d<(s=(n=t.Cartesian3.magnitudeSquared(C))*r))return;if(d>s){o=f*f-s;var h=(u=-f+Math.sqrt(o))/n,M=r/u;return h<M?new i.Interval(h,M):{start:M,stop:h}}var v=Math.sqrt(r/n);return new i.Interval(v,v)}return m<1?(r=m-1,o=f*f-(s=(n=t.Cartesian3.magnitudeSquared(C))*r),u=-f+Math.sqrt(o),new i.Interval(0,u/n)):f<0?(n=t.Cartesian3.magnitudeSquared(C),new i.Interval(0,-f/n)):void 0};var I=new t.Cartesian3,q=new t.Cartesian3,L=new t.Cartesian3,E=new t.Cartesian3,z=new t.Cartesian3,T=new o.Matrix3,U=new o.Matrix3,B=new o.Matrix3,W=new o.Matrix3,_=new o.Matrix3,V=new o.Matrix3,Z=new o.Matrix3,A=new t.Cartesian3,D=new t.Cartesian3,j=new e.Cartographic;M.grazingAltitudeLocation=function(a,e){var n=a.origin,i=a.direction;if(!t.Cartesian3.equals(n,t.Cartesian3.ZERO)){var c=e.geodeticSurfaceNormal(n,I);if(t.Cartesian3.dot(i,c)>=0)return n}var l=r.defined(this.rayEllipsoid(a,e)),C=e.transformPositionToScaledSpace(i,I),f=t.Cartesian3.normalize(C,C),d=t.Cartesian3.mostOrthogonalAxis(C,E),h=t.Cartesian3.normalize(t.Cartesian3.cross(d,f,q),q),M=t.Cartesian3.normalize(t.Cartesian3.cross(f,h,L),L),v=T;v[0]=f.x,v[1]=f.y,v[2]=f.z,v[3]=h.x,v[4]=h.y,v[5]=h.z,v[6]=M.x,v[7]=M.y,v[8]=M.z;var g=o.Matrix3.transpose(v,U),p=o.Matrix3.fromScale(e.radii,B),w=o.Matrix3.fromScale(e.oneOverRadii,W),R=_;R[0]=0,R[1]=-i.z,R[2]=i.y,R[3]=i.z,R[4]=0,R[5]=-i.x,R[6]=-i.y,R[7]=i.x,R[8]=0;var O,S,P=o.Matrix3.multiply(o.Matrix3.multiply(g,w,V),R,V),y=o.Matrix3.multiply(o.Matrix3.multiply(P,p,Z),v,Z),x=o.Matrix3.multiplyByVector(P,n,z),N=function(a,e,r,n,i){var c,l=n*n,C=i*i,f=(a[o.Matrix3.COLUMN1ROW1]-a[o.Matrix3.COLUMN2ROW2])*C,d=i*(n*b(a[o.Matrix3.COLUMN1ROW0],a[o.Matrix3.COLUMN0ROW1],s.CesiumMath.EPSILON15)+e.y),h=a[o.Matrix3.COLUMN0ROW0]*l+a[o.Matrix3.COLUMN2ROW2]*C+n*e.x+r,M=C*b(a[o.Matrix3.COLUMN2ROW1],a[o.Matrix3.COLUMN1ROW2],s.CesiumMath.EPSILON15),v=i*(n*b(a[o.Matrix3.COLUMN2ROW0],a[o.Matrix3.COLUMN0ROW2])+e.z),g=[];if(0===v&&0===M){if(0===(c=u.computeRealRoots(f,d,h)).length)return g;var p=c[0],w=Math.sqrt(Math.max(1-p*p,0));if(g.push(new t.Cartesian3(n,i*p,i*-w)),g.push(new t.Cartesian3(n,i*p,i*w)),2===c.length){var R=c[1],O=Math.sqrt(Math.max(1-R*R,0));g.push(new t.Cartesian3(n,i*R,i*-O)),g.push(new t.Cartesian3(n,i*R,i*O))}return g}var S=v*v,P=M*M,y=v*M,x=f*f+P,N=2*(d*f+y),I=2*h*f+d*d-P+S,q=2*(h*d-y),L=h*h-S;if(0===x&&0===N&&0===I&&0===q)return g;var E=(c=m.computeRealRoots(x,N,I,q,L)).length;if(0===E)return g;for(var z=0;z<E;++z){var T=c[z],U=T*T,B=Math.max(1-U,0),W=Math.sqrt(B),_=(s.CesiumMath.sign(f)===s.CesiumMath.sign(h)?b(f*U+h,d*T,s.CesiumMath.EPSILON12):s.CesiumMath.sign(h)===s.CesiumMath.sign(d*T)?b(f*U,d*T+h,s.CesiumMath.EPSILON12):b(f*U+d*T,h,s.CesiumMath.EPSILON12))*b(M*T,v,s.CesiumMath.EPSILON15);_<0?g.push(new t.Cartesian3(n,i*T,i*W)):_>0?g.push(new t.Cartesian3(n,i*T,i*-W)):0!==W?(g.push(new t.Cartesian3(n,i*T,i*-W)),g.push(new t.Cartesian3(n,i*T,i*W)),++z):g.push(new t.Cartesian3(n,i*T,i*W))}return g}(y,t.Cartesian3.negate(x,I),0,0,1),G=N.length;if(G>0){for(var Y=t.Cartesian3.clone(t.Cartesian3.ZERO,D),X=Number.NEGATIVE_INFINITY,k=0;k<G;++k){O=o.Matrix3.multiplyByVector(p,o.Matrix3.multiplyByVector(v,N[k],A),A);var F=t.Cartesian3.normalize(t.Cartesian3.subtract(O,n,E),E),H=t.Cartesian3.dot(F,i);H>X&&(X=H,Y=t.Cartesian3.clone(O,Y))}var J=e.cartesianToCartographic(Y,j);return X=s.CesiumMath.clamp(X,0,1),S=t.Cartesian3.magnitude(t.Cartesian3.subtract(Y,n,E))*Math.sqrt(1-X*X),S=l?-S:S,J.height=S,e.cartographicToCartesian(J,new t.Cartesian3)}};var G=new t.Cartesian3;function Y(a,e){this.normal=t.Cartesian3.clone(a),this.distance=e}M.lineSegmentPlane=function(a,e,n,i){r.defined(i)||(i=new t.Cartesian3);var o=t.Cartesian3.subtract(e,a,G),u=n.normal,c=t.Cartesian3.dot(u,o);if(!(Math.abs(c)<s.CesiumMath.EPSILON6)){var l=t.Cartesian3.dot(u,a),C=-(n.distance+l)/c;if(!(C<0||C>1))return t.Cartesian3.multiplyByScalar(o,C,i),t.Cartesian3.add(a,i,i),i}},M.trianglePlaneIntersection=function(a,e,r,n){var i,s,o=n.normal,u=n.distance,c=t.Cartesian3.dot(o,a)+u<0,l=t.Cartesian3.dot(o,e)+u<0,C=t.Cartesian3.dot(o,r)+u<0,m=0;if(m+=c?1:0,m+=l?1:0,1!==(m+=C?1:0)&&2!==m||(i=new t.Cartesian3,s=new t.Cartesian3),1===m){if(c)return M.lineSegmentPlane(a,e,n,i),M.lineSegmentPlane(a,r,n,s),{positions:[a,e,r,i,s],indices:[0,3,4,1,2,4,1,4,3]};if(l)return M.lineSegmentPlane(e,r,n,i),M.lineSegmentPlane(e,a,n,s),{positions:[a,e,r,i,s],indices:[1,3,4,2,0,4,2,4,3]};if(C)return M.lineSegmentPlane(r,a,n,i),M.lineSegmentPlane(r,e,n,s),{positions:[a,e,r,i,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===m){if(!c)return M.lineSegmentPlane(e,a,n,i),M.lineSegmentPlane(r,a,n,s),{positions:[a,e,r,i,s],indices:[1,2,4,1,4,3,0,3,4]};if(!l)return M.lineSegmentPlane(r,e,n,i),M.lineSegmentPlane(a,e,n,s),{positions:[a,e,r,i,s],indices:[2,0,4,2,4,3,1,3,4]};if(!C)return M.lineSegmentPlane(a,r,n,i),M.lineSegmentPlane(e,r,n,s),{positions:[a,e,r,i,s],indices:[0,1,4,0,4,3,2,3,4]}}},Y.fromPointNormal=function(a,e,n){var i=-t.Cartesian3.dot(e,a);return r.defined(n)?(t.Cartesian3.clone(e,n.normal),n.distance=i,n):new Y(e,i)};var X=new t.Cartesian3;Y.fromCartesian4=function(a,e){var n=t.Cartesian3.fromCartesian4(a,X),i=a.w;return r.defined(e)?(t.Cartesian3.clone(n,e.normal),e.distance=i,e):new Y(n,i)},Y.getPointDistance=function(a,e){return t.Cartesian3.dot(a.normal,e)+a.distance};var k=new t.Cartesian3;Y.projectPointOntoPlane=function(a,e,n){r.defined(n)||(n=new t.Cartesian3);var i=Y.getPointDistance(a,e),s=t.Cartesian3.multiplyByScalar(a.normal,i,k);return t.Cartesian3.subtract(e,s,n)};var F=new t.Cartesian3;Y.transform=function(a,e,r){return o.Matrix4.multiplyByPointAsVector(e,a.normal,X),t.Cartesian3.normalize(X,X),t.Cartesian3.multiplyByScalar(a.normal,-a.distance,F),o.Matrix4.multiplyByPoint(e,F,F),Y.fromPointNormal(F,X,r)},Y.clone=function(a,e){return r.defined(e)?(t.Cartesian3.clone(a.normal,e.normal),e.distance=a.distance,e):new Y(a.normal,a.distance)},Y.equals=function(a,e){return a.distance===e.distance&&t.Cartesian3.equals(a.normal,e.normal)},Y.ORIGIN_XY_PLANE=Object.freeze(new Y(t.Cartesian3.UNIT_Z,0)),Y.ORIGIN_YZ_PLANE=Object.freeze(new Y(t.Cartesian3.UNIT_X,0)),Y.ORIGIN_ZX_PLANE=Object.freeze(new Y(t.Cartesian3.UNIT_Y,0)),a.IntersectionTests=M,a.Plane=Y,a.Ray=h}));
