define(["./when-b60132fc","./buildModuleUrl-9a89655b","./EllipsoidRhumbLine-d305ae76","./arrayFill-4513d7ad","./BoundingRectangle-20dd2e63","./Cartesian2-99e64452","./Cartesian4-69ef58e5","./Cartographic-00721f3e","./Check-7b2a090c","./FeatureDetection-ab6f364c","./EllipsoidGeodesic-dbda39ad","./EllipsoidTangentPlane-d397ceb5","./GeometryAttribute-f3b3c776","./PolygonGeometryLibrary-8e7f000d","./GeometryOffsetAttribute-fbeb6f1a","./GeometryPipeline-ff15c36b","./IndexDatatype-d62ee188","./Math-119be1a3","./Transforms-f4127659","./VertexFormat-6446fca0","./WebGLConstants-aba9fc67","./Plane-622eaee2","./PrimitiveType-ebb8c588","./GeometryAttributes-252e9929","./earcut-2.2.1-20c8012f","./AttributeCompression-cd5fdf14","./EncodedCartesian3-3bcc61bb"],(function(e,t,r,a,o,i,n,s,l,u,c,p,y,g,d,m,h,f,b,v,_,P,x,w,C,T,A){"use strict";var E=new s.Cartographic,I=new s.Cartographic;function G(e,t,r,a){var o=a.cartesianToCartographic(e,E).height,i=a.cartesianToCartographic(t,I);i.height=o,a.cartographicToCartesian(i,t);var n=a.cartesianToCartographic(r,I);n.height=o-100,a.cartographicToCartesian(n,r)}var V=new o.BoundingRectangle,F=new n.Cartesian3,N=new n.Cartesian3,H=new n.Cartesian3,O=new n.Cartesian3,R=new n.Cartesian3,L=new n.Cartesian3,D=new n.Cartesian3,M=new n.Cartesian3,S=new n.Cartesian3,B=new i.Cartesian2,k=new i.Cartesian2,z=new n.Cartesian3,Y=new b.Quaternion,U=new i.Matrix3,W=new i.Matrix3;function j(t){var r=t.vertexFormat,o=t.geometry,s=t.shadowVolume,l=o.attributes.position.values,c=l.length,p=t.wall,g=t.top||p,m=t.bottom||p;if(r.st||r.normal||r.tangent||r.bitangent||s){var h=t.boundingRectangle,v=t.tangentPlane,_=t.ellipsoid,P=t.stRotation,x=t.perPositionHeight,w=B;w.x=h.x,w.y=h.y;var C,T=r.st?new Float32Array(c/3*2):void 0;r.normal&&(C=x&&g&&!p?o.attributes.normal.values:new Float32Array(c));var A=r.tangent?new Float32Array(c):void 0,E=r.bitangent?new Float32Array(c):void 0,I=s?new Float32Array(c):void 0,V=0,j=0,Q=N,q=H,K=O,Z=!0,J=U,X=W;if(0!==P){var $=b.Quaternion.fromAxisAngle(v._plane.normal,P,Y);J=i.Matrix3.fromQuaternion($,J),$=b.Quaternion.fromAxisAngle(v._plane.normal,-P,Y),X=i.Matrix3.fromQuaternion($,X)}else J=i.Matrix3.clone(i.Matrix3.IDENTITY,J),X=i.Matrix3.clone(i.Matrix3.IDENTITY,X);var ee=0,te=0;g&&m&&(ee=c/2,te=c/3,c/=2);for(var re=0;re<c;re+=3){var ae=n.Cartesian3.fromArray(l,re,z);if(r.st){var oe=i.Matrix3.multiplyByVector(J,ae,F);oe=_.scaleToGeodeticSurface(oe,oe);var ie=v.projectPointOntoPlane(oe,k);i.Cartesian2.subtract(ie,w,ie);var ne=f.CesiumMath.clamp(ie.x/h.width,0,1),se=f.CesiumMath.clamp(ie.y/h.height,0,1);m&&(T[V+te]=ne,T[V+1+te]=se),g&&(T[V]=ne,T[V+1]=se),V+=2}if(r.normal||r.tangent||r.bitangent||s){var le=j+1,ue=j+2;if(p){if(re+3<c){var ce=n.Cartesian3.fromArray(l,re+3,R);if(Z){var pe=n.Cartesian3.fromArray(l,re+c,L);x&&G(ae,ce,pe,_),n.Cartesian3.subtract(ce,ae,ce),n.Cartesian3.subtract(pe,ae,pe),Q=n.Cartesian3.normalize(n.Cartesian3.cross(pe,ce,Q),Q),Z=!1}n.Cartesian3.equalsEpsilon(ce,ae,f.CesiumMath.EPSILON10)&&(Z=!0)}(r.tangent||r.bitangent)&&(K=_.geodeticSurfaceNormal(ae,K),r.tangent&&(q=n.Cartesian3.normalize(n.Cartesian3.cross(K,Q,q),q)))}else Q=_.geodeticSurfaceNormal(ae,Q),(r.tangent||r.bitangent)&&(x&&(D=n.Cartesian3.fromArray(C,j,D),M=n.Cartesian3.cross(n.Cartesian3.UNIT_Z,D,M),M=n.Cartesian3.normalize(i.Matrix3.multiplyByVector(X,M,M),M),r.bitangent&&(S=n.Cartesian3.normalize(n.Cartesian3.cross(D,M,S),S))),q=n.Cartesian3.cross(n.Cartesian3.UNIT_Z,Q,q),q=n.Cartesian3.normalize(i.Matrix3.multiplyByVector(X,q,q),q),r.bitangent&&(K=n.Cartesian3.normalize(n.Cartesian3.cross(Q,q,K),K)));r.normal&&(t.wall?(C[j+ee]=Q.x,C[le+ee]=Q.y,C[ue+ee]=Q.z):m&&(C[j+ee]=-Q.x,C[le+ee]=-Q.y,C[ue+ee]=-Q.z),(g&&!x||p)&&(C[j]=Q.x,C[le]=Q.y,C[ue]=Q.z)),s&&(p&&(Q=_.geodeticSurfaceNormal(ae,Q)),I[j+ee]=-Q.x,I[le+ee]=-Q.y,I[ue+ee]=-Q.z),r.tangent&&(t.wall?(A[j+ee]=q.x,A[le+ee]=q.y,A[ue+ee]=q.z):m&&(A[j+ee]=-q.x,A[le+ee]=-q.y,A[ue+ee]=-q.z),g&&(x?(A[j]=M.x,A[le]=M.y,A[ue]=M.z):(A[j]=q.x,A[le]=q.y,A[ue]=q.z))),r.bitangent&&(m&&(E[j+ee]=K.x,E[le+ee]=K.y,E[ue+ee]=K.z),g&&(x?(E[j]=S.x,E[le]=S.y,E[ue]=S.z):(E[j]=K.x,E[le]=K.y,E[ue]=K.z))),j+=3}}r.st&&(o.attributes.st=new y.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:T})),r.normal&&(o.attributes.normal=new y.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:C})),r.tangent&&(o.attributes.tangent=new y.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),r.bitangent&&(o.attributes.bitangent=new y.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:E})),s&&(o.attributes.extrudeDirection=new y.GeometryAttribute({componentDatatype:u.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:I}))}if(t.extrude&&e.defined(t.offsetAttribute)){var ye=l.length/3,ge=new Uint8Array(ye);if(t.offsetAttribute===d.GeometryOffsetAttribute.TOP)g&&m||p?ge=a.arrayFill(ge,1,0,ye/2):g&&(ge=a.arrayFill(ge,1));else{var de=t.offsetAttribute===d.GeometryOffsetAttribute.NONE?0:1;ge=a.arrayFill(ge,de)}o.attributes.applyOffset=new y.GeometryAttribute({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:ge})}return o}var Q=new s.Cartographic,q=new s.Cartographic,K={west:0,east:0},Z=new c.EllipsoidGeodesic;function J(a,o,i,n,s){if(s=e.defaultValue(s,new t.Rectangle),!e.defined(a)||a.length<3)return s.west=0,s.north=0,s.south=0,s.east=0,s;if(i===r.ArcType.RHUMB)return t.Rectangle.fromCartesianArray(a,o,s);Z.ellipsoid.equals(o)||(Z=new c.EllipsoidGeodesic(void 0,void 0,o)),s.west=Number.POSITIVE_INFINITY,s.east=Number.NEGATIVE_INFINITY,s.south=Number.POSITIVE_INFINITY,s.north=Number.NEGATIVE_INFINITY,K.west=Number.POSITIVE_INFINITY,K.east=Number.NEGATIVE_INFINITY;for(var l,u=1/f.CesiumMath.chordLength(n,o.maximumRadius),p=a.length,y=o.cartesianToCartographic(a[0],q),g=Q,d=1;d<p;d++)l=g,g=y,y=o.cartesianToCartographic(a[d],l),Z.setEndPoints(g,y),$(Z,u,s,K);return l=g,g=y,y=o.cartesianToCartographic(a[0],l),Z.setEndPoints(g,y),$(Z,u,s,K),s.east-s.west>K.west-K.east&&(s.east=K.east,s.west=K.west),s}var X=new s.Cartographic;function $(e,t,r,a){for(var o=e.surfaceDistance,i=Math.ceil(o*t),n=i>0?o/(i-1):Number.POSITIVE_INFINITY,s=0,l=0;l<i;l++){var u=e.interpolateUsingSurfaceDistance(s,X);s+=n;var c=u.longitude,p=u.latitude;r.west=Math.min(r.west,c),r.east=Math.max(r.east,c),r.south=Math.min(r.south,p),r.north=Math.max(r.north,p),a.west=c>0?Math.min(c,a.west):a.west,a.east=c<0?Math.max(c,a.east):a.east}}var ee=[];function te(e,t,r,a,o,i,n,s,l,u){var c,y={walls:[]};if(i||n){var d,m,f=g.PolygonGeometryLibrary.createGeometryFromPositions(e,t,r,o,s,l),b=f.attributes.position.values,v=f.indices;if(i&&n){var _=b.concat(b);d=_.length/3,(m=h.IndexDatatype.createTypedArray(d,2*v.length)).set(v);var P=v.length,x=d/2;for(c=0;c<P;c+=3){var w=m[c]+x,C=m[c+1]+x,T=m[c+2]+x;m[c+P]=T,m[c+1+P]=C,m[c+2+P]=w}if(f.attributes.position.values=_,o&&s.normal){var A=f.attributes.normal.values;f.attributes.normal.values=new Float32Array(_.length),f.attributes.normal.values.set(A)}f.indices=m}else if(n){for(d=b.length/3,m=h.IndexDatatype.createTypedArray(d,v.length),c=0;c<v.length;c+=3)m[c]=v[c+2],m[c+1]=v[c+1],m[c+2]=v[c];f.indices=m}y.topAndBottom=new g.GeometryInstance({geometry:f})}var E,I=a.outerRing,G=p.EllipsoidTangentPlane.fromPoints(I,e),V=G.projectPointsOntoPlane(I,ee),F=g.PolygonPipeline.computeWindingOrder2D(V);F===g.WindingOrder.CLOCKWISE&&(I=I.slice().reverse()),u&&(E=g.PolygonGeometryLibrary.computeWallGeometry(I,e,r,o,l),y.walls.push(new g.GeometryInstance({geometry:E})));var N=a.holes;for(c=0;c<N.length;c++){var H=N[c];V=(G=p.EllipsoidTangentPlane.fromPoints(H,e)).projectPointsOntoPlane(H,ee),(F=g.PolygonPipeline.computeWindingOrder2D(V))===g.WindingOrder.COUNTER_CLOCKWISE&&(H=H.slice().reverse()),E=g.PolygonGeometryLibrary.computeWallGeometry(H,e,r,o,l),y.walls.push(new g.GeometryInstance({geometry:E}))}return y}function re(a){var o=a.polygonHierarchy,i=e.defaultValue(a.vertexFormat,v.VertexFormat.DEFAULT),n=e.defaultValue(a.ellipsoid,t.Ellipsoid.WGS84),s=e.defaultValue(a.granularity,f.CesiumMath.RADIANS_PER_DEGREE),l=e.defaultValue(a.stRotation,0),u=e.defaultValue(a.perPositionHeight,!1),c=u&&e.defined(a.extrudedHeight),p=e.defaultValue(a.height,0),y=e.defaultValue(a.extrudedHeight,p);if(!c){var d=Math.max(p,y);y=Math.min(p,y),p=d}this._vertexFormat=v.VertexFormat.clone(i),this._ellipsoid=t.Ellipsoid.clone(n),this._granularity=s,this._stRotation=l,this._height=p,this._extrudedHeight=y,this._closeTop=e.defaultValue(a.closeTop,!0),this._closeBottom=e.defaultValue(a.closeBottom,!0),this._extrudeOutering=e.defaultValue(a.extrudeOutering,!0),this._polygonHierarchy=o,this._perPositionHeight=u,this._perPositionHeightExtrude=c,this._shadowVolume=e.defaultValue(a.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=a.offsetAttribute,this._arcType=e.defaultValue(a.arcType,r.ArcType.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=g.PolygonGeometryLibrary.computeHierarchyPackedLength(o)+t.Ellipsoid.packedLength+v.VertexFormat.packedLength+12}re.fromPositions=function(t){return new re({polygonHierarchy:{positions:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions},height:t.height,extrudedHeight:t.extrudedHeight,vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid,granularity:t.granularity,perPositionHeight:t.perPositionHeight,closeTop:t.closeTop,closeBottom:t.closeBottom,offsetAttribute:t.offsetAttribute,arcType:t.arcType})},re.pack=function(r,a,o){return o=e.defaultValue(o,0),o=g.PolygonGeometryLibrary.packPolygonHierarchy(r._polygonHierarchy,a,o),t.Ellipsoid.pack(r._ellipsoid,a,o),o+=t.Ellipsoid.packedLength,v.VertexFormat.pack(r._vertexFormat,a,o),o+=v.VertexFormat.packedLength,a[o++]=r._height,a[o++]=r._extrudedHeight,a[o++]=r._granularity,a[o++]=r._stRotation,a[o++]=r._perPositionHeightExtrude?1:0,a[o++]=r._perPositionHeight?1:0,a[o++]=r._closeTop?1:0,a[o++]=r._closeBottom?1:0,a[o++]=r._shadowVolume?1:0,a[o++]=e.defaultValue(r._offsetAttribute,-1),a[o++]=r._arcType,a[o]=r.packedLength,a};var ae=t.Ellipsoid.clone(t.Ellipsoid.UNIT_SPHERE),oe=new v.VertexFormat,ie={polygonHierarchy:{}};return re.unpack=function(r,a,o){a=e.defaultValue(a,0);var i=g.PolygonGeometryLibrary.unpackPolygonHierarchy(r,a);a=i.startingIndex,delete i.startingIndex;var n=t.Ellipsoid.unpack(r,a,ae);a+=t.Ellipsoid.packedLength;var s=v.VertexFormat.unpack(r,a,oe);a+=v.VertexFormat.packedLength;var l=r[a++],u=r[a++],c=r[a++],p=r[a++],y=1===r[a++],d=1===r[a++],m=1===r[a++],h=1===r[a++],f=1===r[a++],b=r[a++],_=r[a++],P=r[a];return e.defined(o)||(o=new re(ie)),o._polygonHierarchy=i,o._ellipsoid=t.Ellipsoid.clone(n,o._ellipsoid),o._vertexFormat=v.VertexFormat.clone(s,o._vertexFormat),o._height=l,o._extrudedHeight=u,o._granularity=c,o._stRotation=p,o._perPositionHeightExtrude=y,o._perPositionHeight=d,o._closeTop=m,o._closeBottom=h,o._shadowVolume=f,o._offsetAttribute=-1===b?void 0:b,o._arcType=_,o.packedLength=P,o},re.computeRectangle=function(a,o){var i=e.defaultValue(a.granularity,f.CesiumMath.RADIANS_PER_DEGREE),n=e.defaultValue(a.arcType,r.ArcType.GEODESIC),s=a.polygonHierarchy,l=e.defaultValue(a.ellipsoid,t.Ellipsoid.WGS84);return J(s.positions,l,n,i,o)},re.createGeometry=function(r){var o=r._vertexFormat,i=r._ellipsoid,n=r._granularity,s=r._stRotation,l=r._polygonHierarchy,c=r._perPositionHeight,b=r._closeTop,v=r._closeBottom,_=r._arcType,P=l.positions;if(!(P.length<3)){var x=p.EllipsoidTangentPlane.fromPoints(P,i),w=g.PolygonGeometryLibrary.polygonsFromHierarchy(l,x.projectPointsOntoPlane.bind(x),!c,i),C=w.hierarchy,T=w.polygons;if(0!==C.length){P=C[0].outerRing;var A,E=g.PolygonGeometryLibrary.computeBoundingRectangle(x.plane.normal,x.projectPointOntoPlane.bind(x),P,s,V),I=[],G=r._height,F=r._extrudedHeight,N={perPositionHeight:c,vertexFormat:o,geometry:void 0,tangentPlane:x,boundingRectangle:E,ellipsoid:i,stRotation:s,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:_};if(r._perPositionHeightExtrude||!f.CesiumMath.equalsEpsilon(G,F,0,f.CesiumMath.EPSILON2))for(N.extrude=!0,N.top=b,N.bottom=v,N.shadowVolume=r._shadowVolume,N.offsetAttribute=r._offsetAttribute,A=0;A<T.length;A++){var H,O=te(i,T[A],n,C[A],c,b,v,o,_,r._extrudeOutering);b&&v?(H=O.topAndBottom,N.geometry=g.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(H.geometry,G,F,i,c)):b?((H=O.topAndBottom).geometry.attributes.position.values=g.PolygonPipeline.scaleToGeodeticHeight(H.geometry.attributes.position.values,G,i,!c),N.geometry=H.geometry):v&&((H=O.topAndBottom).geometry.attributes.position.values=g.PolygonPipeline.scaleToGeodeticHeight(H.geometry.attributes.position.values,F,i,!0),N.geometry=H.geometry),(b||v)&&(N.wall=!1,H.geometry=j(N),I.push(H));var R=O.walls;N.wall=!0;for(var L=0;L<R.length;L++){var D=R[L];N.geometry=g.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(D.geometry,G,F,i,c),D.geometry=j(N),I.push(D)}}else for(A=0;A<T.length;A++){var M=new g.GeometryInstance({geometry:g.PolygonGeometryLibrary.createGeometryFromPositions(i,T[A],n,c,o,_)});if(M.geometry.attributes.position.values=g.PolygonPipeline.scaleToGeodeticHeight(M.geometry.attributes.position.values,G,i,!c),N.geometry=M.geometry,M.geometry=j(N),e.defined(r._offsetAttribute)){var S=M.geometry.attributes.position.values.length,B=new Uint8Array(S/3),k=r._offsetAttribute===d.GeometryOffsetAttribute.NONE?0:1;a.arrayFill(B,k),M.geometry.attributes.applyOffset=new y.GeometryAttribute({componentDatatype:u.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:B})}I.push(M)}var z=m.GeometryPipeline.combineInstances(I)[0];z.attributes.position.values=new Float64Array(z.attributes.position.values),z.indices=h.IndexDatatype.createTypedArray(z.attributes.position.values.length/3,z.indices);var Y=z.attributes,U=t.BoundingSphere.fromVertices(Y.position.values);return o.position||delete Y.position,new y.Geometry({attributes:Y,indices:z.indices,primitiveType:z.primitiveType,boundingSphere:U,offsetAttribute:r._offsetAttribute})}}},re.createShadowVolume=function(e,t,r){var a=e._granularity,o=e._ellipsoid,i=t(a,o),n=r(a,o);return new re({polygonHierarchy:e._polygonHierarchy,ellipsoid:o,stRotation:e._stRotation,granularity:a,perPositionHeight:!1,extrudedHeight:i,height:n,vertexFormat:v.VertexFormat.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(re.prototype,{rectangle:{get:function(){if(!e.defined(this._rectangle)){var t=this._polygonHierarchy.positions;this._rectangle=J(t,this._ellipsoid,this._arcType,this._granularity)}return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return e.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0===t)return[0,0,0,1,1,0];var r=e._ellipsoid,a=e._polygonHierarchy.positions,o=e.rectangle;return y.Geometry._textureCoordinateRotationPoints(a,t,r,o)}(this)),this._textureCoordinateRotationPoints}}}),function(r,a){return e.defined(a)&&(r=re.unpack(r,a)),r._ellipsoid=t.Ellipsoid.clone(r._ellipsoid),re.createGeometry(r)}}));
