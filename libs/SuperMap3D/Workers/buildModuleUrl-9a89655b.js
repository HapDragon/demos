define(["exports","./Cartesian4-69ef58e5","./Cartographic-00721f3e","./Check-7b2a090c","./when-b60132fc","./Math-119be1a3","./Cartesian2-99e64452","./WebGLConstants-aba9fc67"],(function(e,t,r,n,a,i,s,o){"use strict";function u(e,r,n,s){r=a.defaultValue(r,0),n=a.defaultValue(n,0),s=a.defaultValue(s,0),i.CesiumMath.equalsEpsilon(s,6356752.314245179,i.CesiumMath.EPSILON10)&&(i.CesiumMath.Radius=s),e._radii=new t.Cartesian3(r,n,s),e._radiiSquared=new t.Cartesian3(r*r,n*n,s*s),e._radiiToTheFourth=new t.Cartesian3(r*r*r*r,n*n*n*n,s*s*s*s),e._oneOverRadii=new t.Cartesian3(0===r?0:1/r,0===n?0:1/n,0===s?0:1/s),e._oneOverRadiiSquared=new t.Cartesian3(0===r?0:1/(r*r),0===n?0:1/(n*n),0===s?0:1/(s*s)),e._minimumRadius=Math.min(r,n,s),e._maximumRadius=Math.max(r,n,s),e._centerToleranceSquared=i.CesiumMath.EPSILON1,0!==e._radiiSquared.z&&(e._squaredXOverSquaredZ=e._radiiSquared.x/e._radiiSquared.z)}function d(e,t,r){this._radii=void 0,this._radiiSquared=void 0,this._radiiToTheFourth=void 0,this._oneOverRadii=void 0,this._oneOverRadiiSquared=void 0,this._minimumRadius=void 0,this._maximumRadius=void 0,this._centerToleranceSquared=void 0,this._squaredXOverSquaredZ=void 0,u(this,e,t,r)}Object.defineProperties(d.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}}),d.clone=function(e,r){if(a.defined(e)){var n=e._radii;return a.defined(r)?(t.Cartesian3.clone(n,r._radii),t.Cartesian3.clone(e._radiiSquared,r._radiiSquared),t.Cartesian3.clone(e._radiiToTheFourth,r._radiiToTheFourth),t.Cartesian3.clone(e._oneOverRadii,r._oneOverRadii),t.Cartesian3.clone(e._oneOverRadiiSquared,r._oneOverRadiiSquared),r._minimumRadius=e._minimumRadius,r._maximumRadius=e._maximumRadius,r._centerToleranceSquared=e._centerToleranceSquared,r):new d(n.x,n.y,n.z)}},d.fromCartesian3=function(e,t){return a.defined(t)||(t=new d),a.defined(e)?(u(t,e.x,e.y,e.z),t):t},d.WGS84=Object.freeze(new d(6378137,6378137,i.CesiumMath.Radius)),d.XIAN80=Object.freeze(new d(6378140,6378140,6356755.29)),d.CGCS2000=Object.freeze(new d(6378137,6378137,6356752.31)),d.UNIT_SPHERE=Object.freeze(new d(1,1,1)),d.MOON=Object.freeze(new d(i.CesiumMath.LUNAR_RADIUS,i.CesiumMath.LUNAR_RADIUS,i.CesiumMath.LUNAR_RADIUS)),d.prototype.clone=function(e){return d.clone(this,e)},d.packedLength=t.Cartesian3.packedLength,d.pack=function(e,r,n){return n=a.defaultValue(n,0),t.Cartesian3.pack(e._radii,r,n),r},d.unpack=function(e,r,n){r=a.defaultValue(r,0);var i=t.Cartesian3.unpack(e,r);return d.fromCartesian3(i,n)},d.prototype.geocentricSurfaceNormal=t.Cartesian3.normalize,d.prototype.geodeticSurfaceNormalCartographic=function(e,r){var n=e.longitude,i=e.latitude,s=Math.cos(i),o=s*Math.cos(n),u=s*Math.sin(n),d=Math.sin(i);return a.defined(r)||(r=new t.Cartesian3),r.x=o,r.y=u,r.z=d,t.Cartesian3.normalize(r,r)},d.prototype.geodeticSurfaceNormal=function(e,r){return a.defined(r)||(r=new t.Cartesian3),r=t.Cartesian3.multiplyComponents(e,this._oneOverRadiiSquared,r),t.Cartesian3.normalize(r,r)};var c=new t.Cartesian3,f=new t.Cartesian3;d.prototype.cartographicToCartesian=function(e,r){var n=c,i=f;this.geodeticSurfaceNormalCartographic(e,n),t.Cartesian3.multiplyComponents(this._radiiSquared,n,i);var s=Math.sqrt(t.Cartesian3.dot(n,i));return t.Cartesian3.divideByScalar(i,s,i),t.Cartesian3.multiplyByScalar(n,e.height,n),a.defined(r)||(r=new t.Cartesian3),t.Cartesian3.add(i,n,r)},d.prototype.cartographicArrayToCartesianArray=function(e,t){var r=e.length;a.defined(t)?t.length=r:t=new Array(r);for(var n=0;n<r;n++)t[n]=this.cartographicToCartesian(e[n],t[n]);return t};var h=new t.Cartesian3,l=new t.Cartesian3,p=new t.Cartesian3;function m(e){this._ellipsoid=a.defaultValue(e,d.WGS84),this._semimajorAxis=this._ellipsoid.maximumRadius,this._oneOverSemimajorAxis=1/this._semimajorAxis}d.prototype.cartesianToCartographic=function(e,n){var s=this.scaleToGeodeticSurface(e,l);if(a.defined(s)){var o=this.geodeticSurfaceNormal(s,h),u=t.Cartesian3.subtract(e,s,p),d=Math.atan2(o.y,o.x),c=Math.asin(o.z),f=i.CesiumMath.sign(t.Cartesian3.dot(u,e))*t.Cartesian3.magnitude(u);return a.defined(n)?(n.longitude=d,n.latitude=c,n.height=f,n):new r.Cartographic(d,c,f)}},d.prototype.cartesianArrayToCartographicArray=function(e,t){var r=e.length;a.defined(t)?t.length=r:t=new Array(r);for(var n=0;n<r;++n)t[n]=this.cartesianToCartographic(e[n],t[n]);return t},d.prototype.scaleToGeodeticSurface=function(e,t){return r.scaleToGeodeticSurface(e,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,t)},d.prototype.scaleToGeocentricSurface=function(e,r){a.defined(r)||(r=new t.Cartesian3);var n=e.x,i=e.y,s=e.z,o=this._oneOverRadiiSquared,u=1/Math.sqrt(n*n*o.x+i*i*o.y+s*s*o.z);return t.Cartesian3.multiplyByScalar(e,u,r)},d.prototype.transformPositionToScaledSpace=function(e,r){return a.defined(r)||(r=new t.Cartesian3),t.Cartesian3.multiplyComponents(e,this._oneOverRadii,r)},d.prototype.transformPositionFromScaledSpace=function(e,r){return a.defined(r)||(r=new t.Cartesian3),t.Cartesian3.multiplyComponents(e,this._radii,r)},d.prototype.equals=function(e){return this===e||a.defined(e)&&t.Cartesian3.equals(this._radii,e._radii)},d.prototype.toString=function(){return this._radii.toString()},d.prototype.getSurfaceNormalIntersectionWithZAxis=function(e,r,n){r=a.defaultValue(r,0);var i=this._squaredXOverSquaredZ;if(a.defined(n)||(n=new t.Cartesian3),n.x=0,n.y=0,n.z=e.z*(1-i),!(Math.abs(n.z)>=this._radii.z-r))return n},Object.defineProperties(m.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}}),m.prototype.project=function(e,r){var n=this._semimajorAxis,i=e.longitude*n,s=e.latitude*n,o=e.height;return a.defined(r)?(r.x=i,r.y=s,r.z=o,r):new t.Cartesian3(i,s,o)},m.prototype.unproject=function(e,t){var n=this._oneOverSemimajorAxis,i=e.x*n,s=e.y*n,o=e.z;return a.defined(t)?(t.longitude=i,t.latitude=s,t.height=o,t):new r.Cartographic(i,s,o)};var y=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1});function v(e,t){this.start=a.defaultValue(e,0),this.stop=a.defaultValue(t,0)}function C(e,t,r,n){this.west=a.defaultValue(e,0),this.south=a.defaultValue(t,0),this.east=a.defaultValue(r,0),this.north=a.defaultValue(n,0)}Object.defineProperties(C.prototype,{width:{get:function(){return C.computeWidth(this)}},height:{get:function(){return C.computeHeight(this)}}}),C.packedLength=4,C.pack=function(e,t,r){return r=a.defaultValue(r,0),t[r++]=e.west,t[r++]=e.south,t[r++]=e.east,t[r]=e.north,t},C.unpack=function(e,t,r){return t=a.defaultValue(t,0),a.defined(r)||(r=new C),r.west=e[t++],r.south=e[t++],r.east=e[t++],r.north=e[t],r},C.computeWidth=function(e){var t=e.east,r=e.west;return t<r&&(t+=i.CesiumMath.TWO_PI),t-r},C.computeHeight=function(e){return e.north-e.south},C.fromDegrees=function(e,t,r,n,s){return e=i.CesiumMath.toRadians(a.defaultValue(e,0)),t=i.CesiumMath.toRadians(a.defaultValue(t,0)),r=i.CesiumMath.toRadians(a.defaultValue(r,0)),n=i.CesiumMath.toRadians(a.defaultValue(n,0)),a.defined(s)?(s.west=e,s.south=t,s.east=r,s.north=n,s):new C(e,t,r,n)},C.fromRadians=function(e,t,r,n,i){return a.defined(i)?(i.west=a.defaultValue(e,0),i.south=a.defaultValue(t,0),i.east=a.defaultValue(r,0),i.north=a.defaultValue(n,0),i):new C(e,t,r,n)},C.fromCartographicArray=function(e,t){for(var r=Number.MAX_VALUE,n=-Number.MAX_VALUE,s=Number.MAX_VALUE,o=-Number.MAX_VALUE,u=Number.MAX_VALUE,d=-Number.MAX_VALUE,c=0,f=e.length;c<f;c++){var h=e[c];r=Math.min(r,h.longitude),n=Math.max(n,h.longitude),u=Math.min(u,h.latitude),d=Math.max(d,h.latitude);var l=h.longitude>=0?h.longitude:h.longitude+i.CesiumMath.TWO_PI;s=Math.min(s,l),o=Math.max(o,l)}return n-r>o-s&&(r=s,(n=o)>i.CesiumMath.PI&&(n-=i.CesiumMath.TWO_PI),r>i.CesiumMath.PI&&(r-=i.CesiumMath.TWO_PI)),a.defined(t)?(t.west=r,t.south=u,t.east=n,t.north=d,t):new C(r,u,n,d)},C.fromCartesianArray=function(e,t,r){t=a.defaultValue(t,d.WGS84);for(var n=Number.MAX_VALUE,s=-Number.MAX_VALUE,o=Number.MAX_VALUE,u=-Number.MAX_VALUE,c=Number.MAX_VALUE,f=-Number.MAX_VALUE,h=0,l=e.length;h<l;h++){var p=t.cartesianToCartographic(e[h]);n=Math.min(n,p.longitude),s=Math.max(s,p.longitude),c=Math.min(c,p.latitude),f=Math.max(f,p.latitude);var m=p.longitude>=0?p.longitude:p.longitude+i.CesiumMath.TWO_PI;o=Math.min(o,m),u=Math.max(u,m)}return s-n>u-o&&(n=o,(s=u)>i.CesiumMath.PI&&(s-=i.CesiumMath.TWO_PI),n>i.CesiumMath.PI&&(n-=i.CesiumMath.TWO_PI)),a.defined(r)?(r.west=n,r.south=c,r.east=s,r.north=f,r):new C(n,c,s,f)},C.clone=function(e,t){if(a.defined(e))return a.defined(t)?(t.west=e.west,t.south=e.south,t.east=e.east,t.north=e.north,t):new C(e.west,e.south,e.east,e.north)},C.equalsEpsilon=function(e,t,r){return e===t||a.defined(e)&&a.defined(t)&&Math.abs(e.west-t.west)<=r&&Math.abs(e.south-t.south)<=r&&Math.abs(e.east-t.east)<=r&&Math.abs(e.north-t.north)<=r},C.prototype.clone=function(e){return C.clone(this,e)},C.prototype.equals=function(e){return C.equals(this,e)},C.equals=function(e,t){return e===t||a.defined(e)&&a.defined(t)&&e.west===t.west&&e.south===t.south&&e.east===t.east&&e.north===t.north},C.prototype.equalsEpsilon=function(e,t){return C.equalsEpsilon(this,e,t)},C.validate=function(e){},C.southwest=function(e,t){return a.defined(t)?(t.longitude=e.west,t.latitude=e.south,t.height=0,t):new r.Cartographic(e.west,e.south)},C.northwest=function(e,t){return a.defined(t)?(t.longitude=e.west,t.latitude=e.north,t.height=0,t):new r.Cartographic(e.west,e.north)},C.northeast=function(e,t){return a.defined(t)?(t.longitude=e.east,t.latitude=e.north,t.height=0,t):new r.Cartographic(e.east,e.north)},C.southeast=function(e,t){return a.defined(t)?(t.longitude=e.east,t.latitude=e.south,t.height=0,t):new r.Cartographic(e.east,e.south)},C.center=function(e,t){var n=e.east,s=e.west;n<s&&(n+=i.CesiumMath.TWO_PI);var o=i.CesiumMath.negativePiToPi(.5*(s+n)),u=.5*(e.south+e.north);return a.defined(t)?(t.longitude=o,t.latitude=u,t.height=0,t):new r.Cartographic(o,u)},C.intersection=function(e,t,r){var n=e.east,s=e.west,o=t.east,u=t.west;n<s&&o>0?n+=i.CesiumMath.TWO_PI:o<u&&n>0&&(o+=i.CesiumMath.TWO_PI),n<s&&u<0?u+=i.CesiumMath.TWO_PI:o<u&&s<0&&(s+=i.CesiumMath.TWO_PI);var d=i.CesiumMath.negativePiToPi(Math.max(s,u)),c=i.CesiumMath.negativePiToPi(Math.min(n,o));if(!((e.west<e.east||t.west<t.east)&&c<=d)){var f=Math.max(e.south,t.south),h=Math.min(e.north,t.north);if(!(f>=h))return a.defined(r)?(r.west=d,r.south=f,r.east=c,r.north=h,r):new C(d,f,c,h)}},C.simpleIntersection=function(e,t,r){var n=Math.max(e.west,t.west),i=Math.max(e.south,t.south),s=Math.min(e.east,t.east),o=Math.min(e.north,t.north);if(!(i>=o||n>=s))return a.defined(r)?(r.west=n,r.south=i,r.east=s,r.north=o,r):new C(n,i,s,o)},C.union=function(e,t,r){a.defined(r)||(r=new C);var n=e.east,s=e.west,o=t.east,u=t.west;n<s&&o>0?n+=i.CesiumMath.TWO_PI:o<u&&n>0&&(o+=i.CesiumMath.TWO_PI),n<s&&u<0?u+=i.CesiumMath.TWO_PI:o<u&&s<0&&(s+=i.CesiumMath.TWO_PI);var d=i.CesiumMath.convertLongitudeRange(Math.min(s,u)),c=i.CesiumMath.convertLongitudeRange(Math.max(n,o));return r.west=d,r.south=Math.min(e.south,t.south),r.east=c,r.north=Math.max(e.north,t.north),r},C.expand=function(e,t,r){return a.defined(r)||(r=new C),r.west=Math.min(e.west,t.longitude),r.south=Math.min(e.south,t.latitude),r.east=Math.max(e.east,t.longitude),r.north=Math.max(e.north,t.latitude),r},C.contains=function(e,t){var r=t.longitude,n=t.latitude,a=e.west,s=e.east;return s<a&&(s+=i.CesiumMath.TWO_PI,r<0&&(r+=i.CesiumMath.TWO_PI)),(r>a||i.CesiumMath.equalsEpsilon(r,a,i.CesiumMath.EPSILON14))&&(r<s||i.CesiumMath.equalsEpsilon(r,s,i.CesiumMath.EPSILON14))&&n>=e.south&&n<=e.north};var g=new r.Cartographic;C.subsample=function(e,t,r,n){t=a.defaultValue(t,d.WGS84),r=a.defaultValue(r,0),a.defined(n)||(n=[]);var s=0,o=e.north,u=e.south,c=e.east,f=e.west,h=g;h.height=r,h.longitude=f,h.latitude=o,n[s]=t.cartographicToCartesian(h,n[s]),s++,h.longitude=c,n[s]=t.cartographicToCartesian(h,n[s]),s++,h.latitude=u,n[s]=t.cartographicToCartesian(h,n[s]),s++,h.longitude=f,n[s]=t.cartographicToCartesian(h,n[s]),s++,h.latitude=o<0?o:u>0?u:0;for(var l=1;l<8;++l)h.longitude=-Math.PI+l*i.CesiumMath.PI_OVER_TWO,C.contains(e,h)&&(n[s]=t.cartographicToCartesian(h,n[s]),s++);return 0===h.latitude&&(h.longitude=f,n[s]=t.cartographicToCartesian(h,n[s]),s++,h.longitude=c,n[s]=t.cartographicToCartesian(h,n[s]),s++),n.length=s,n};var q=new r.Cartographic;function w(e,r){this.center=t.Cartesian3.clone(a.defaultValue(e,t.Cartesian3.ZERO)),this.radius=a.defaultValue(r,0)}C.prototype.contains=function(e){return C.contains(this,C.southwest(e,q))&&C.contains(this,C.northwest(e,q))&&C.contains(this,C.southeast(e,q))&&C.contains(this,C.northeast(e,q))},C.MAX_VALUE=Object.freeze(new C(-Math.PI,-i.CesiumMath.PI_OVER_TWO,Math.PI,i.CesiumMath.PI_OVER_TWO));var _=new t.Cartesian3,R=new t.Cartesian3,b=new t.Cartesian3,O=new t.Cartesian3,S=new t.Cartesian3,A=new t.Cartesian3,x=new t.Cartesian3,M=new t.Cartesian3,T=new t.Cartesian3,E=new t.Cartesian3,I=new t.Cartesian3,P=new t.Cartesian3,V=4/3*i.CesiumMath.PI;w.fromPoints=function(e,r){if(a.defined(r)||(r=new w),!a.defined(e)||0===e.length)return r.center=t.Cartesian3.clone(t.Cartesian3.ZERO,r.center),r.radius=0,r;var n,i=t.Cartesian3.clone(e[0],x),s=t.Cartesian3.clone(i,_),o=t.Cartesian3.clone(i,R),u=t.Cartesian3.clone(i,b),d=t.Cartesian3.clone(i,O),c=t.Cartesian3.clone(i,S),f=t.Cartesian3.clone(i,A),h=e.length;for(n=1;n<h;n++){t.Cartesian3.clone(e[n],i);var l=i.x,p=i.y,m=i.z;l<s.x&&t.Cartesian3.clone(i,s),l>d.x&&t.Cartesian3.clone(i,d),p<o.y&&t.Cartesian3.clone(i,o),p>c.y&&t.Cartesian3.clone(i,c),m<u.z&&t.Cartesian3.clone(i,u),m>f.z&&t.Cartesian3.clone(i,f)}var y=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(d,s,M)),v=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(c,o,M)),C=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(f,u,M)),g=s,q=d,V=y;v>V&&(V=v,g=o,q=c),C>V&&(V=C,g=u,q=f);var U=T;U.x=.5*(g.x+q.x),U.y=.5*(g.y+q.y),U.z=.5*(g.z+q.z);var k=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(q,U,M)),z=Math.sqrt(k),L=E;L.x=s.x,L.y=o.y,L.z=u.z;var B=I;B.x=d.x,B.y=c.y,B.z=f.z;var D=t.Cartesian3.midpoint(L,B,P),N=0;for(n=0;n<h;n++){t.Cartesian3.clone(e[n],i);var j=t.Cartesian3.magnitude(t.Cartesian3.subtract(i,D,M));j>N&&(N=j);var K=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(i,U,M));if(K>k){var F=Math.sqrt(K);k=(z=.5*(z+F))*z;var H=F-z;U.x=(z*U.x+H*i.x)/F,U.y=(z*U.y+H*i.y)/F,U.z=(z*U.z+H*i.z)/F}}return z<N?(t.Cartesian3.clone(U,r.center),r.radius=z):(t.Cartesian3.clone(D,r.center),r.radius=N),r};var U=new m,k=new t.Cartesian3,z=new t.Cartesian3,L=new r.Cartographic,B=new r.Cartographic;w.fromRectangle2D=function(e,t,r){return w.fromRectangleWithHeights2D(e,t,0,0,r)},w.fromRectangleWithHeights2D=function(e,r,n,i,s){if(a.defined(s)||(s=new w),!a.defined(e))return s.center=t.Cartesian3.clone(t.Cartesian3.ZERO,s.center),s.radius=0,s;r=a.defaultValue(r,U),C.southwest(e,L),L.height=n,C.northeast(e,B),B.height=i;var o=r.project(L,k),u=r.project(B,z),d=u.x-o.x,c=u.y-o.y,f=u.z-o.z;s.radius=.5*Math.sqrt(d*d+c*c+f*f);var h=s.center;return h.x=o.x+.5*d,h.y=o.y+.5*c,h.z=o.z+.5*f,s};var D=[];w.fromRectangle3D=function(e,r,n,i){if(r=a.defaultValue(r,d.WGS84),n=a.defaultValue(n,0),a.defined(i)||(i=new w),!a.defined(e))return i.center=t.Cartesian3.clone(t.Cartesian3.ZERO,i.center),i.radius=0,i;var s=C.subsample(e,r,n,D);return w.fromPoints(s,i)},w.fromVertices=function(e,r,n,i){if(a.defined(i)||(i=new w),!a.defined(e)||0===e.length)return i.center=t.Cartesian3.clone(t.Cartesian3.ZERO,i.center),i.radius=0,i;r=a.defaultValue(r,t.Cartesian3.ZERO),n=a.defaultValue(n,3);var s=x;s.x=e[0]+r.x,s.y=e[1]+r.y,s.z=e[2]+r.z;var o,u=t.Cartesian3.clone(s,_),d=t.Cartesian3.clone(s,R),c=t.Cartesian3.clone(s,b),f=t.Cartesian3.clone(s,O),h=t.Cartesian3.clone(s,S),l=t.Cartesian3.clone(s,A),p=e.length;for(o=0;o<p;o+=n){var m=e[o]+r.x,y=e[o+1]+r.y,v=e[o+2]+r.z;s.x=m,s.y=y,s.z=v,m<u.x&&t.Cartesian3.clone(s,u),m>f.x&&t.Cartesian3.clone(s,f),y<d.y&&t.Cartesian3.clone(s,d),y>h.y&&t.Cartesian3.clone(s,h),v<c.z&&t.Cartesian3.clone(s,c),v>l.z&&t.Cartesian3.clone(s,l)}var C=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(f,u,M)),g=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(h,d,M)),q=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(l,c,M)),V=u,U=f,k=C;g>k&&(k=g,V=d,U=h),q>k&&(k=q,V=c,U=l);var z=T;z.x=.5*(V.x+U.x),z.y=.5*(V.y+U.y),z.z=.5*(V.z+U.z);var L=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(U,z,M)),B=Math.sqrt(L),D=E;D.x=u.x,D.y=d.y,D.z=c.z;var N=I;N.x=f.x,N.y=h.y,N.z=l.z;var j=t.Cartesian3.midpoint(D,N,P),K=0;for(o=0;o<p;o+=n){s.x=e[o]+r.x,s.y=e[o+1]+r.y,s.z=e[o+2]+r.z;var F=t.Cartesian3.magnitude(t.Cartesian3.subtract(s,j,M));F>K&&(K=F);var H=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(s,z,M));if(H>L){var W=Math.sqrt(H);L=(B=.5*(B+W))*B;var X=W-B;z.x=(B*z.x+X*s.x)/W,z.y=(B*z.y+X*s.y)/W,z.z=(B*z.z+X*s.z)/W}}return B<K?(t.Cartesian3.clone(z,i.center),i.radius=B):(t.Cartesian3.clone(j,i.center),i.radius=K),i},w.fromEncodedCartesianVertices=function(e,r,n){if(a.defined(n)||(n=new w),!a.defined(e)||!a.defined(r)||e.length!==r.length||0===e.length)return n.center=t.Cartesian3.clone(t.Cartesian3.ZERO,n.center),n.radius=0,n;var i=x;i.x=e[0]+r[0],i.y=e[1]+r[1],i.z=e[2]+r[2];var s,o=t.Cartesian3.clone(i,_),u=t.Cartesian3.clone(i,R),d=t.Cartesian3.clone(i,b),c=t.Cartesian3.clone(i,O),f=t.Cartesian3.clone(i,S),h=t.Cartesian3.clone(i,A),l=e.length;for(s=0;s<l;s+=3){var p=e[s]+r[s],m=e[s+1]+r[s+1],y=e[s+2]+r[s+2];i.x=p,i.y=m,i.z=y,p<o.x&&t.Cartesian3.clone(i,o),p>c.x&&t.Cartesian3.clone(i,c),m<u.y&&t.Cartesian3.clone(i,u),m>f.y&&t.Cartesian3.clone(i,f),y<d.z&&t.Cartesian3.clone(i,d),y>h.z&&t.Cartesian3.clone(i,h)}var v=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(c,o,M)),C=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(f,u,M)),g=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(h,d,M)),q=o,V=c,U=v;C>U&&(U=C,q=u,V=f),g>U&&(U=g,q=d,V=h);var k=T;k.x=.5*(q.x+V.x),k.y=.5*(q.y+V.y),k.z=.5*(q.z+V.z);var z=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(V,k,M)),L=Math.sqrt(z),B=E;B.x=o.x,B.y=u.y,B.z=d.z;var D=I;D.x=c.x,D.y=f.y,D.z=h.z;var N=t.Cartesian3.midpoint(B,D,P),j=0;for(s=0;s<l;s+=3){i.x=e[s]+r[s],i.y=e[s+1]+r[s+1],i.z=e[s+2]+r[s+2];var K=t.Cartesian3.magnitude(t.Cartesian3.subtract(i,N,M));K>j&&(j=K);var F=t.Cartesian3.magnitudeSquared(t.Cartesian3.subtract(i,k,M));if(F>z){var H=Math.sqrt(F);z=(L=.5*(L+H))*L;var W=H-L;k.x=(L*k.x+W*i.x)/H,k.y=(L*k.y+W*i.y)/H,k.z=(L*k.z+W*i.z)/H}}return L<j?(t.Cartesian3.clone(k,n.center),n.radius=L):(t.Cartesian3.clone(N,n.center),n.radius=j),n},w.fromCornerPoints=function(e,r,n){a.defined(n)||(n=new w);var i=t.Cartesian3.midpoint(e,r,n.center);return n.radius=t.Cartesian3.distance(i,r),n},w.fromEllipsoid=function(e,r){return a.defined(r)||(r=new w),t.Cartesian3.clone(t.Cartesian3.ZERO,r.center),r.radius=e.maximumRadius,r};var N=new t.Cartesian3;w.fromBoundingSpheres=function(e,r){if(a.defined(r)||(r=new w),!a.defined(e)||0===e.length)return r.center=t.Cartesian3.clone(t.Cartesian3.ZERO,r.center),r.radius=0,r;var n=e.length;if(1===n)return w.clone(e[0],r);if(2===n)return w.union(e[0],e[1],r);var i,s=[];for(i=0;i<n;i++)s.push(e[i].center);var o=(r=w.fromPoints(s,r)).center,u=r.radius;for(i=0;i<n;i++){var d=e[i];u=Math.max(u,t.Cartesian3.distance(o,d.center,N)+d.radius)}return r.radius=u,r};var j=new t.Cartesian3,K=new t.Cartesian3,F=new t.Cartesian3;w.fromOrientedBoundingBox=function(e,r){a.defined(r)||(r=new w);var n=e.halfAxes,i=s.Matrix3.getColumn(n,0,j),o=s.Matrix3.getColumn(n,1,K),u=s.Matrix3.getColumn(n,2,F);return t.Cartesian3.add(i,o,i),t.Cartesian3.add(i,u,i),r.center=t.Cartesian3.clone(e.center,r.center),r.radius=t.Cartesian3.magnitude(i),r},w.clone=function(e,r){if(a.defined(e))return a.defined(r)?(r.center=t.Cartesian3.clone(e.center,r.center),r.radius=e.radius,r):new w(e.center,e.radius)},w.packedLength=4,w.pack=function(e,t,r){r=a.defaultValue(r,0);var n=e.center;return t[r++]=n.x,t[r++]=n.y,t[r++]=n.z,t[r]=e.radius,t},w.unpack=function(e,t,r){t=a.defaultValue(t,0),a.defined(r)||(r=new w);var n=r.center;return n.x=e[t++],n.y=e[t++],n.z=e[t++],r.radius=e[t],r};var H=new t.Cartesian3,W=new t.Cartesian3;w.union=function(e,r,n){a.defined(n)||(n=new w);var i=e.center,s=e.radius,o=r.center,u=r.radius,d=t.Cartesian3.subtract(o,i,H),c=t.Cartesian3.magnitude(d);if(s>=c+u)return e.clone(n),n;if(u>=c+s)return r.clone(n),n;var f=.5*(s+c+u),h=t.Cartesian3.multiplyByScalar(d,(-s+f)/c,W);return t.Cartesian3.add(h,i,h),t.Cartesian3.clone(h,n.center),n.radius=f,n};var X=new t.Cartesian3;w.expand=function(e,r,n){n=w.clone(e,n);var a=t.Cartesian3.magnitude(t.Cartesian3.subtract(r,n.center,X));return a>n.radius&&(n.radius=a),n},w.intersectPlane=function(e,r){var n=e.center,a=e.radius,i=r.normal,s=t.Cartesian3.dot(i,n)+r.distance;return s<-a?y.OUTSIDE:s<a?y.INTERSECTING:y.INSIDE},w.transform=function(e,t,r){return a.defined(r)||(r=new w),r.center=s.Matrix4.multiplyByPoint(t,e.center,r.center),r.radius=s.Matrix4.getMaximumScale(t)*e.radius,r};var G=new t.Cartesian3;w.distanceSquaredTo=function(e,r){var n=t.Cartesian3.subtract(e.center,r,G);return t.Cartesian3.magnitudeSquared(n)-e.radius*e.radius},w.transformWithoutScale=function(e,t,r){return a.defined(r)||(r=new w),r.center=s.Matrix4.multiplyByPoint(t,e.center,r.center),r.radius=e.radius,r};var Y=new t.Cartesian3;w.computePlaneDistances=function(e,r,n,i){a.defined(i)||(i=new v);var s=t.Cartesian3.subtract(e.center,r,Y),o=t.Cartesian3.dot(n,s);return i.start=o-e.radius,i.stop=o+e.radius,i};for(var J=new t.Cartesian3,Z=new t.Cartesian3,Q=new t.Cartesian3,$=new t.Cartesian3,ee=new t.Cartesian3,te=new r.Cartographic,re=new Array(8),ne=0;ne<8;++ne)re[ne]=new t.Cartesian3;var ae=new m;
/**
     * @license
     *
     * Grauw URI utilities
     *
     * See: http://hg.grauw.nl/grauw-lib/file/tip/src/uri.js
     *
     * @author Laurens Holst (http://www.grauw.nl/)
     *
     *   Copyright 2012 Laurens Holst
     *
     *   Licensed under the Apache License, Version 2.0 (the "License");
     *   you may not use this file except in compliance with the License.
     *   You may obtain a copy of the License at
     *
     *       http://www.apache.org/licenses/LICENSE-2.0
     *
     *   Unless required by applicable law or agreed to in writing, software
     *   distributed under the License is distributed on an "AS IS" BASIS,
     *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     *   See the License for the specific language governing permissions and
     *   limitations under the License.
     *
     */
function ie(e){if(e instanceof ie)this.scheme=e.scheme,this.authority=e.authority,this.path=e.path,this.query=e.query,this.fragment=e.fragment;else if(e){var t=se.exec(e);this.scheme=t[1],this.authority=t[2],this.path=t[3],this.query=t[4],this.fragment=t[5]}}w.projectTo2D=function(e,r,n){var i,s=(r=a.defaultValue(r,ae)).ellipsoid,o=e.center,u=e.radius;i=t.Cartesian3.equals(o,t.Cartesian3.ZERO)?t.Cartesian3.clone(t.Cartesian3.UNIT_X,J):s.geodeticSurfaceNormal(o,J);var d=t.Cartesian3.cross(t.Cartesian3.UNIT_Z,i,Z);t.Cartesian3.normalize(d,d);var c=t.Cartesian3.cross(i,d,Q);t.Cartesian3.normalize(c,c),t.Cartesian3.multiplyByScalar(i,u,i),t.Cartesian3.multiplyByScalar(c,u,c),t.Cartesian3.multiplyByScalar(d,u,d);var f=t.Cartesian3.negate(c,ee),h=t.Cartesian3.negate(d,$),l=re,p=l[0];t.Cartesian3.add(i,c,p),t.Cartesian3.add(p,d,p),p=l[1],t.Cartesian3.add(i,c,p),t.Cartesian3.add(p,h,p),p=l[2],t.Cartesian3.add(i,f,p),t.Cartesian3.add(p,h,p),p=l[3],t.Cartesian3.add(i,f,p),t.Cartesian3.add(p,d,p),t.Cartesian3.negate(i,i),p=l[4],t.Cartesian3.add(i,c,p),t.Cartesian3.add(p,d,p),p=l[5],t.Cartesian3.add(i,c,p),t.Cartesian3.add(p,h,p),p=l[6],t.Cartesian3.add(i,f,p),t.Cartesian3.add(p,h,p),p=l[7],t.Cartesian3.add(i,f,p),t.Cartesian3.add(p,d,p);for(var m=l.length,y=0;y<m;++y){var v=l[y];t.Cartesian3.add(o,v,v);var C=s.cartesianToCartographic(v,te);r.project(C,v)}var g=(o=(n=w.fromPoints(l,n)).center).x,q=o.y,_=o.z;return o.x=_,o.y=g,o.z=q,n},w.isOccluded=function(e,t){return!t.isBoundingSphereVisible(e)},w.equals=function(e,r){return e===r||a.defined(e)&&a.defined(r)&&t.Cartesian3.equals(e.center,r.center)&&e.radius===r.radius},w.prototype.intersectPlane=function(e){return w.intersectPlane(this,e)},w.prototype.distanceSquaredTo=function(e){return w.distanceSquaredTo(this,e)},w.prototype.computePlaneDistances=function(e,t,r){return w.computePlaneDistances(this,e,t,r)},w.prototype.isOccluded=function(e){return w.isOccluded(this,e)},w.prototype.equals=function(e){return w.equals(this,e)},w.prototype.clone=function(e){return w.clone(this,e)},w.prototype.volume=function(){var e=this.radius;return V*e*e*e},ie.prototype.scheme=null,ie.prototype.authority=null,ie.prototype.path="",ie.prototype.query=null,ie.prototype.fragment=null;var se=new RegExp("^(?:([^:/?#]+):)?(?://([^/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$");ie.prototype.getScheme=function(){return this.scheme},ie.prototype.getAuthority=function(){return this.authority},ie.prototype.getPath=function(){return this.path},ie.prototype.getQuery=function(){return this.query},ie.prototype.getFragment=function(){return this.fragment},ie.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment},ie.prototype.isSameDocumentAs=function(e){return e.scheme==this.scheme&&e.authority==this.authority&&e.path==this.path&&e.query==this.query},ie.prototype.equals=function(e){return this.isSameDocumentAs(e)&&e.fragment==this.fragment},ie.prototype.normalize=function(){this.removeDotSegments(),this.scheme&&(this.scheme=this.scheme.toLowerCase()),this.authority&&(this.authority=this.authority.replace(de,fe).replace(oe,ce)),this.path&&(this.path=this.path.replace(oe,ce)),this.query&&(this.query=this.query.replace(oe,ce)),this.fragment&&(this.fragment=this.fragment.replace(oe,ce))};var oe=/%[0-9a-z]{2}/gi,ue=/[a-zA-Z0-9\-\._~]/,de=/(.*@)?([^@:]*)(:.*)?/;function ce(e){var t=unescape(e);return ue.test(t)?t:e.toUpperCase()}function fe(e,t,r,n){return(t||"")+r.toLowerCase()+(n||"")}function he(e,t){if(null===e||"object"!=typeof e)return e;t=a.defaultValue(t,!1);var r=new e.constructor;for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];t&&(i=he(i,t)),r[n]=i}return r}function le(e,t,r){r=a.defaultValue(r,!1);var n,i,s,o={},u=a.defined(e),d=a.defined(t);if(u)for(n in e)e.hasOwnProperty(n)&&(i=e[n],d&&r&&"object"==typeof i&&t.hasOwnProperty(n)?(s=t[n],o[n]="object"==typeof s?le(i,s,r):i):o[n]=i);if(d)for(n in t)t.hasOwnProperty(n)&&!o.hasOwnProperty(n)&&(s=t[n],o[n]=s);return o}function pe(e,t){var r;return"undefined"!=typeof document&&(r=document),pe._implementation(e,t,r)}ie.prototype.resolve=function(e){var t=new ie;return this.scheme?(t.scheme=this.scheme,t.authority=this.authority,t.path=this.path,t.query=this.query):(t.scheme=e.scheme,this.authority?(t.authority=this.authority,t.path=this.path,t.query=this.query):(t.authority=e.authority,""==this.path?(t.path=e.path,t.query=this.query||e.query):("/"==this.path.charAt(0)?(t.path=this.path,t.removeDotSegments()):(e.authority&&""==e.path?t.path="/"+this.path:t.path=e.path.substring(0,e.path.lastIndexOf("/")+1)+this.path,t.removeDotSegments()),t.query=this.query))),t.fragment=this.fragment,t},ie.prototype.removeDotSegments=function(){var e,t=this.path.split("/"),r=[],n=""==t[0];for(n&&t.shift(),""==t[0]&&t.shift();t.length;)".."==(e=t.shift())?r.pop():"."!=e&&r.push(e);"."!=e&&".."!=e||r.push(""),n&&r.unshift(""),this.path=r.join("/")},ie.prototype.toString=function(){var e="";return this.scheme&&(e+=this.scheme+":"),this.authority&&(e+="//"+this.authority),e+=this.path,this.query&&(e+="?"+this.query),this.fragment&&(e+="#"+this.fragment),e},pe._implementation=function(e,t,r){if(!a.defined(t)){if(void 0===r)return e;t=a.defaultValue(r.baseURI,r.location.href)}var n=new ie(t);return new ie(e).resolve(n).toString()};var me,ye=/^blob:/i;function ve(e){return ye.test(e)}var Ce=/^data:/i;function ge(e){return Ce.test(e)}var qe=Object.freeze({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5}),we=Object.freeze({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3,PACK:4,BLOCK:5,BLOCKPACK:6});function _e(e){e=a.defaultValue(e,a.defaultValue.EMPTY_OBJECT);var t=a.defaultValue(e.throttleByServer,!1),r=a.defaultValue(e.throttle,!1);this.url=e.url,this.requestFunction=e.requestFunction,this.cancelFunction=e.cancelFunction,this.priorityFunction=e.priorityFunction,this.priority=a.defaultValue(e.priority,0),this.throttle=r,this.throttleByServer=t,this.type=a.defaultValue(e.type,we.OTHER),this.serverKey=void 0,this.state=qe.UNISSUED,this.deferred=void 0,this.cancelled=!1}function Re(e,t,r){this.statusCode=e,this.response=t,this.responseHeaders=r,"string"==typeof this.responseHeaders&&(this.responseHeaders=function(e){var t={};if(!e)return t;for(var r=e.split("\r\n"),n=0;n<r.length;++n){var a=r[n],i=a.indexOf(": ");if(i>0){var s=a.substring(0,i),o=a.substring(i+2);t[s]=o}}return t}(this.responseHeaders))}function be(){this._listeners=[],this._scopes=[],this._toRemove=[],this._insideRaiseEvent=!1}function Oe(e,t){return t-e}function Se(e){this._comparator=e.comparator,this._array=[],this._length=0,this._maximumLength=void 0}function Ae(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}_e.prototype.cancel=function(){this.cancelled=!0},_e.prototype.clone=function(e){return a.defined(e)?(e.url=this.url,e.requestFunction=this.requestFunction,e.cancelFunction=this.cancelFunction,e.priorityFunction=this.priorityFunction,e.priority=this.priority,e.throttle=this.throttle,e.throttleByServer=this.throttleByServer,e.type=this.type,e.serverKey=this.serverKey,e.state=this.RequestState.UNISSUED,e.deferred=void 0,e.cancelled=!1,e):new _e(this)},Re.prototype.toString=function(){var e="Request has failed.";return a.defined(this.statusCode)&&(e+=" Status Code: "+this.statusCode),e},Object.defineProperties(be.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}}),be.prototype.addEventListener=function(e,t){this._listeners.push(e),this._scopes.push(t);var r=this;return function(){r.removeEventListener(e,t)}},be.prototype.removeEventListener=function(e,t){for(var r=this._listeners,n=this._scopes,a=-1,i=0;i<r.length;i++)if(r[i]===e&&n[i]===t){a=i;break}return-1!==a&&(this._insideRaiseEvent?(this._toRemove.push(a),r[a]=void 0,n[a]=void 0):(r.splice(a,1),n.splice(a,1)),!0)},be.prototype.raiseEvent=function(){var e;this._insideRaiseEvent=!0;var t=this._listeners,r=this._scopes,n=t.length;for(e=0;e<n;e++){var i=t[e];a.defined(i)&&t[e].apply(r[e],arguments)}var s=this._toRemove;if((n=s.length)>0){for(s.sort(Oe),e=0;e<n;e++){var o=s[e];t.splice(o,1),r.splice(o,1)}s.length=0}this._insideRaiseEvent=!1},Object.defineProperties(Se.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(e){this._maximumLength=e,this._length>e&&e>0&&(this._length=e,this._array.length=e)}},comparator:{get:function(){return this._comparator}}}),Se.prototype.reserve=function(e){e=a.defaultValue(e,this._length),this._array.length=e},Se.prototype.heapify=function(e){e=a.defaultValue(e,0);for(var t=this._length,r=this._comparator,n=this._array,i=-1,s=!0;s;){var o=2*(e+1),u=o-1;i=u<t&&r(n[u],n[e])<0?u:e,o<t&&r(n[o],n[i])<0&&(i=o),i!==e?(Ae(n,i,e),e=i):s=!1}},Se.prototype.resort=function(){for(var e=this._length,t=Math.ceil(e/2);t>=0;--t)this.heapify(t)},Se.prototype.insert=function(e){var t,r=this._array,n=this._comparator,i=this._maximumLength,s=this._length++;for(s<r.length?r[s]=e:r.push(e);0!==s;){var o=Math.floor((s-1)/2);if(!(n(r[s],r[o])<0))break;Ae(r,s,o),s=o}return a.defined(i)&&this._length>i&&(t=r[i],r.pop(),this._length=i),t},Se.prototype.pop=function(e){if(e=a.defaultValue(e,0),0!==this._length){var t=this._array,r=t[e];return Ae(t,e,--this._length),t[this._length]=void 0,this.heapify(e),r}};var xe="undefined"!=typeof performance&&"function"==typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()};function Me(e,t){return e.priority-t.priority}var Te={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0,totalRequestTime:0},Ee=20,Ie=new Se({comparator:Me});Ie.maximumLength=Ee,Ie.reserve(Ee);var Pe=[],Ve={},Ue="undefined"!=typeof document?new ie(document.location.href):new ie,ke=new be;function ze(){}function Le(e){a.defined(e.priorityFunction)&&(e.priority=e.priorityFunction())}function Be(e){var t=a.defaultValue(ze.requestsByServer[e],ze.maximumRequestsPerServer);return Ve[e]<t}function De(e){return a.defined(e.packKey)||(e.packKey=e.serverKey+"_"+e.providerName),e.packKey}function Ne(e){return a.defined(e.blockKey)||(e.blockKey=e.serverKey+"_"+e.providerName+"_"+e.quadKey+e.url.substring(e.url.indexOf("dataVersion"))),e.blockKey}function je(e){var t=De(e);return a.defined(ze.packRequestGroup[t])||(ze.packRequestGroup[t]=[]),a.defined(ze.packRequestQuadKey[t])||(ze.packRequestQuadKey[t]=""),a.defined(ze.packRequestPromise[t])||(ze.packRequestPromise[t]=a.when.defer()),a.defined(ze.quadKeyIndex[t])||(ze.quadKeyIndex[t]=0),e.quadKeyIndex=ze.quadKeyIndex[t]++,e.deferred=ze.packRequestPromise[t],e.state=qe.ISSUED,ze.packRequestGroup[t].push(e),e.deferred.promise}function Ke(e){for(var t=0,r=e.length;t<r;t++){e[t].state=qe.CANCELLED}}function Fe(e){for(var t=[],r={},n=0,a=e.length;n<a;n++){var i=e[n];if(!i.cancelled){var s=i.quadKey;r[s]||(r[s]=!0,t.push(s))}}return t}function He(){var e=ze.packRequestGroup;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(r.length<1)continue;var n=r[0].clone(),i=-1!==n.url.indexOf("rest/maps");n.serverKey=r[0].serverKey,n.state=r[0].state;var s=n.url,o=Fe(r);if(o.length<1)continue;ze.packRequestQuadKey[t]=i?o.join(","):o.join(";");var u=ze.packRequestQuadKey[t];if(n.throttleByServer&&!Be(n.serverKey)){Ke(r),ze.packRequestPromise[t].reject();continue}n.deferred=ze.packRequestPromise[t];var d=new ie(s);d.query=i?a.defined(d.query)?d.query+"&tiles="+u:"tiles="+u:a.defined(d.query)?d.query+"&extratiles="+u:"extratiles="+u,n.url=d.toString(),Ge(n,n.url)}ze.packRequestGroup={},ze.packRequestPromise={},ze.packRequestQuadKey={},ze.quadKeyIndex={}}function We(){var e=ze.blockRequest;for(var t in e){if(e.hasOwnProperty(t))Ge(e[t])}ze.blockRequest={}}function Xe(e){if(e.state===qe.UNISSUED)if(e.state=qe.ISSUED,e.type===we.PACK||e.type===we.BLOCKPACK){var t=De(e);a.defined(ze.packRequestPromise[t])||(ze.packRequestPromise[t]=a.when.defer()),e.deferred=ze.packRequestPromise[t]}else e.deferred=a.when.defer();return e.deferred.promise}function Ge(e,t){var r=Xe(e);return e.state=qe.ACTIVE,Pe.push(e),++Te.numberOfActiveRequests,++Te.numberOfActiveRequestsEver,++Ve[e.serverKey],e.startTime=xe(),e.requestFunction(t).then(function(e){return function(t){if(e.state!==qe.CANCELLED&&(--Te.numberOfActiveRequests,--Ve[e.serverKey],ke.raiseEvent(),e.state=qe.RECEIVED,e.deferred.resolve(t),e.endTime=xe(),(ze.statisticRequestTime>0||e.type!==we.OTHER)&&(Te.totalRequestTime+=e.endTime-e.startTime),e.type===we.BLOCK||e.type===we.BLOCKPACK)){var r=Ne(e);a.defined(ze.blockDefer[r])&&(ze.blockDefer[r]=void 0,delete ze.blockDefer[r])}}}(e)).otherwise(function(e){return function(t){e.state!==qe.CANCELLED&&(++Te.numberOfFailedRequests,--Te.numberOfActiveRequests,--Ve[e.serverKey],ke.raiseEvent(t),e.state=qe.FAILED,e.deferred.reject(t))}}(e)),r}function Ye(e){var t=e.state===qe.ACTIVE;e.state=qe.CANCELLED,++Te.numberOfCancelledRequests,e.deferred.reject(),t&&(--Te.numberOfActiveRequests,--Ve[e.serverKey],++Te.numberOfCancelledActiveRequests),a.defined(e.cancelFunction)&&e.cancelFunction()}ze.TIMEOUT=5e3,ze.CANCLE_COUNT=3,ze.statisticRequestTime=-1,ze.maximumRequests=50,ze.maximumRequestsPerServer=6,ze.perPacketCount=20,ze.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18},ze.throttleRequests=!0,ze.debugShowStatistics=!1,ze.requestCompletedEvent=ke,Object.defineProperties(ze,{activeRequestLength:{get:function(){return Pe.length}},statistics:{get:function(){return Te}},priorityHeapLength:{get:function(){return Ee},set:function(e){if(e<Ee)for(;Ie.length>e;){Ye(Ie.pop())}Ee=e,Ie.maximumLength=e,Ie.reserve(e)}}}),ze.packRequestGroup={},ze.packRequestPromise={},ze.packRequestQuadKey={},ze.quadKeyIndex={},ze.packRequestHeap={},ze.blockDefer={},ze.blockRequest={},ze.update=function(){var e,t,r=0,n=Pe.length;for(e=0;e<n;++e)(t=Pe[e]).cancelled&&Ye(t),t.state===qe.ACTIVE?r>0&&(Pe[e-r]=t):++r;Pe.length-=r;var a=Ie.internalArray,i=Ie.length;for(e=0;e<i;++e)Le(a[e]);Ie.resort(),function(){for(var e in ze.packRequestHeap)if(ze.packRequestHeap.hasOwnProperty(e)){for(var t=ze.packRequestHeap[e],r=t.internalArray,n=t.length,a=0;a<n;++a)Le(r[a]);t.resort()}}(),We(),function(){for(var e in ze.packRequestHeap)if(ze.packRequestHeap.hasOwnProperty(e))for(var t=ze.packRequestHeap[e];t.length>0;){var r=t.pop();r.cancelled?Ye(r):je(r)}He()}();for(var s=Math.max(ze.maximumRequests-Pe.length,0),o=0;o<s&&Ie.length>0;)(t=Ie.pop()).cancelled?Ye(t):!t.throttleByServer||Be(t.serverKey)?(Ge(t),++o):Ye(t);!function(){if(!ze.debugShowStatistics)return;0===Te.numberOfActiveRequests&&Te.lastNumberOfActiveRequests>0&&(Te.numberOfAttemptedRequests>0&&(console.log("Number of attempted requests: "+Te.numberOfAttemptedRequests),Te.numberOfAttemptedRequests=0),Te.numberOfCancelledRequests>0&&(console.log("Number of cancelled requests: "+Te.numberOfCancelledRequests),Te.numberOfCancelledRequests=0),Te.numberOfCancelledActiveRequests>0&&(console.log("Number of cancelled active requests: "+Te.numberOfCancelledActiveRequests),Te.numberOfCancelledActiveRequests=0),Te.numberOfFailedRequests>0&&(console.log("Number of failed requests: "+Te.numberOfFailedRequests),Te.numberOfFailedRequests=0));Te.lastNumberOfActiveRequests=Te.numberOfActiveRequests}()},ze.getServerKey=function(e){var t=new ie(e).resolve(Ue);t.normalize();var r=t.authority;/:/.test(r)||(r=r+":"+("https"===t.scheme?"443":"80"));var n=Ve[r];return a.defined(n)||(Ve[r]=0),r},ze.request=function(e){if(ge(e.url)||ve(e.url))return ke.raiseEvent(),e.state=qe.RECEIVED,e.requestFunction();if(++Te.numberOfAttemptedRequests,a.defined(e.serverKey)||(e.serverKey=ze.getServerKey(e.url)),e.type===we.BLOCK)return function(e){var t=Ne(e),r=ze.blockDefer[t];return a.defined(r)||(r=ze.blockDefer[t]=a.when.defer(),ze.blockRequest[t]=e),e.deferred=r,e.state=qe.ISSUED,e.deferred.promise}(e);if(!e.throttleByServer||Be(e.serverKey)){if(!ze.throttleRequests||!e.throttle)return Ge(e);if(!(Pe.length>=ze.maximumRequests)){var t;if(Le(e),e.type===we.PACK||e.type===we.BLOCKPACK){var r=function(e){var t=De(e),r=ze.packRequestHeap[t];return a.defined(r)||((r=ze.packRequestHeap[t]=new Se({comparator:Me})).maximumLength=ze.perPacketCount,r.reserve(Ee)),r}(e),n=!0;if(e.type===we.BLOCKPACK)for(var i=0;i<r.length;i++)if(r._array[i].quadKey===e.quadKey){e.blockRequest=r._array[i],n=!1;break}n&&(t=r.insert(e))}else t=Ie.insert(e);if(a.defined(t)){if(t===e)return;Ye(t)}return Xe(e)}}},ze.clearForSpecs=function(){for(;Ie.length>0;){Ye(Ie.pop())}for(var e=Pe.length,t=0;t<e;++t)Ye(Pe[t]);Pe.length=0,Ve={},Te.numberOfAttemptedRequests=0,Te.numberOfActiveRequests=0,Te.numberOfCancelledRequests=0,Te.numberOfCancelledActiveRequests=0,Te.numberOfFailedRequests=0,Te.numberOfActiveRequestsEver=0,Te.lastNumberOfActiveRequests=0,Te.totalRequestTime=0},ze.numberOfActiveRequestsByServer=function(e){return Ve[e]},ze.requestHeap=Ie;var Je={},Ze={};Je.add=function(e,t){var r=e.toLowerCase()+":"+t;a.defined(Ze[r])||(Ze[r]=!0)},Je.remove=function(e,t){var r=e.toLowerCase()+":"+t;a.defined(Ze[r])&&delete Ze[r]},Je.contains=function(e){var t=function(e){var t=new ie(e);t.normalize();var r=t.getAuthority();if(a.defined(r)){if(-1!==r.indexOf("@")){var n=r.split("@");r=n[1]}if(-1===r.indexOf(":")){var i=t.getScheme();if(a.defined(i)||(i=(i=window.location.protocol).substring(0,i.length-1)),"http"===i)r+=":80";else{if("https"!==i)return;r+=":443"}}return r}}(e);return!(!a.defined(t)||!a.defined(Ze[t]))},Je.clear=function(){Ze={}};var Qe={};function $e(e,t){a.defined(Qe[e])||(Qe[e]=!0,console.warn(a.defaultValue(t,e)))}$e.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.",$e.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored",$e.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored",$e.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";var et,tt=function(){try{var e=new XMLHttpRequest;return e.open("GET","#",!0),e.responseType="blob","blob"===e.responseType}catch(e){return!1}}();function rt(e,t,r,n){var i,s=e.query;if(!a.defined(s)||0===s.length)return{};if(-1===s.indexOf("=")){var o={};o[s]=void 0,i=o}else i=function(e){var t={};if(""===e)return t;for(var r=e.replace(/\+/g,"%20").split(/[&;]/),n=0,i=r.length;n<i;++n){var s=r[n].split("=");if(s.length>2){var o=r[n].indexOf("=");s=[r[n].substring(0,o),r[n].substring(o+1,r[n].length)]}var u=decodeURIComponent(s[0]),d=s[1];d=a.defined(d)?decodeURIComponent(d):"";var c=t[u];"string"==typeof c?t[u]=[c,d]:Array.isArray(c)?c.push(d):t[u]=d}return t}(s);t._queryParameters=r?st(i,t._queryParameters,n):i,e.query=void 0}function nt(e,t){var r=t._queryParameters,n=Object.keys(r);1!==n.length||a.defined(r[n[0]])?e.query=function(e,t){var r="";for(var n in e)if(e.hasOwnProperty(n)){var a=e[n],i=encodeURIComponent(n)+"=";if(Array.isArray(a))for(var s=0,o=a.length;s<o;++s)r+=!0===t?i+encodeURI(a[s])+"&":i+encodeURIComponent(a[s])+"&";else r+=!0===t?i+encodeURI(a)+"&":i+encodeURIComponent(a)+"&"}return r.slice(0,-1)}(r):e.query=n[0]}function at(e,t){return a.defined(e)?a.defined(e.clone)?e.clone():he(e):t}function it(e){if(e.state===qe.ISSUED||e.state===qe.ACTIVE)throw new o.RuntimeError("The Resource is already being fetched.");e.state=qe.UNISSUED,e.deferred=void 0}function st(e,t,r){if(!r)return le(e,t);var n=he(e,!0);for(var i in t)if(t.hasOwnProperty(i)){var s=n[i],o=t[i];a.defined(s)?(Array.isArray(s)||(s=n[i]=[s]),n[i]=s.concat(o)):n[i]=Array.isArray(o)?o.slice():o}return n}function ot(e){"string"==typeof(e=a.defaultValue(e,a.defaultValue.EMPTY_OBJECT))&&(e={url:e}),this._url=void 0,this._templateValues=at(e.templateValues,{}),this._queryParameters=at(e.queryParameters,{}),this.headers=at(e.headers,{}),this.request=a.defaultValue(e.request,new _e),this.proxy=e.proxy,this.retryCallback=e.retryCallback,this.retryAttempts=a.defaultValue(e.retryAttempts,0),this._retryCount=0;var t=new ie(e.url);rt(t,this,!0,!0),t.fragment=void 0,this._url=t.toString()}function ut(e){var t=e.resource,r=e.flipY,n=e.preferImageBitmap,i=t.request;i.url=t.url,i.requestFunction=function(){var e=!1;t.isDataUri||t.isBlobUri||(e=t.isCrossOriginUrl);var s=a.when.defer();return ot._Implementations.createImage(i,e,s,r,n),s.promise};var s=ze.request(i);if(a.defined(s))return s.otherwise((function(e){return i.state!==qe.FAILED?a.when.reject(e):t.retryOnError(e).then((function(s){return s?(i.state=qe.UNISSUED,i.deferred=void 0,ut({resource:t,flipY:r,preferImageBitmap:n})):a.when.reject(e)}))}))}function dt(e,t,r){var n={};n[t]=r,e.setQueryParameters(n);var i=e.request;i.url=e.url,i.requestFunction=function(){var t=a.when.defer();return window[r]=function(e){t.resolve(e);try{delete window[r]}catch(e){window[r]=void 0}},ot._Implementations.loadAndExecuteScript(e.url,r,t),t.promise};var s=ze.request(i);if(a.defined(s))return s.otherwise((function(n){return i.state!==qe.FAILED?a.when.reject(n):e.retryOnError(n).then((function(s){return s?(i.state=qe.UNISSUED,i.deferred=void 0,dt(e,t,r)):a.when.reject(n)}))}))}ot.createIfNeeded=function(e){return e instanceof ot?e.getDerivedResource({request:e.request}):"string"!=typeof e?e:new ot({url:e})},ot.supportsImageBitmapOptions=function(){if(a.defined(et))return et;if("function"!=typeof createImageBitmap)return et=a.when.resolve(!1);return et=ot.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP4////fwAJ+wP9CNHoHgAAAABJRU5ErkJggg=="}).then((function(e){return createImageBitmap(e,{imageOrientation:"flipY",premultiplyAlpha:"none"})})).then((function(e){return!0})).otherwise((function(){return!1}))},Object.defineProperties(ot,{isBlobSupported:{get:function(){return tt}}}),Object.defineProperties(ot.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(e){var t=new ie(e);rt(t,this,!1),t.fragment=void 0,this._url=t.toString()}},extension:{get:function(){return function(e){var t=new ie(e);t.normalize();var r=t.path,n=r.lastIndexOf("/");return-1!==n&&(r=r.substr(n+1)),n=r.lastIndexOf("."),-1===n?"":r.substr(n+1)}(this._url)}},isDataUri:{get:function(){return ge(this._url)}},isBlobUri:{get:function(){return ve(this._url)}},isCrossOriginUrl:{get:function(){return function(e){a.defined(me)||(me=document.createElement("a")),me.href=window.location.href;var t=me.host,r=me.protocol;return me.href=e,me.href=me.href,r!==me.protocol||t!==me.host}(this._url)}},hasHeaders:{get:function(){return Object.keys(this.headers).length>0}}}),ot.prototype.getUrlComponent=function(e,t){if(this.isDataUri)return this._url;var r=new ie(this._url);e&&nt(r,this);var n=r.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),i=this._templateValues;return n=n.replace(/{(.*?)}/g,(function(e,t){var r=i[t];return a.defined(r)?encodeURIComponent(r):e})),t&&a.defined(this.proxy)&&(n=this.proxy.getURL(n)),n},ot.prototype.setQueryParameters=function(e,t){this._queryParameters=t?st(this._queryParameters,e,!1):st(e,this._queryParameters,!1)},ot.prototype.appendQueryParameters=function(e){this._queryParameters=st(e,this._queryParameters,!0)},ot.prototype.setTemplateValues=function(e,t){this._templateValues=t?le(this._templateValues,e):le(e,this._templateValues)},ot.prototype.getDerivedResource=function(e){var t=this.clone();if(t._retryCount=0,a.defined(e.url)){var r=new ie(e.url);rt(r,t,!0,a.defaultValue(e.preserveQueryParameters,!1)),r.fragment=void 0,t._url=r.resolve(new ie(pe(this._url))).toString()}return a.defined(e.queryParameters)&&(t._queryParameters=le(e.queryParameters,t._queryParameters)),a.defined(e.templateValues)&&(t._templateValues=le(e.templateValues,t.templateValues)),a.defined(e.headers)&&(t.headers=le(e.headers,t.headers)),a.defined(e.proxy)&&(t.proxy=e.proxy),a.defined(e.request)&&(t.request=e.request),a.defined(e.retryCallback)&&(t.retryCallback=e.retryCallback),a.defined(e.retryAttempts)&&(t.retryAttempts=e.retryAttempts),t},ot.prototype.retryOnError=function(e){var t=this.retryCallback;if("function"!=typeof t||this._retryCount>=this.retryAttempts)return a.when(!1);var r=this;return a.when(t(this,e)).then((function(e){return++r._retryCount,e}))},ot.prototype.clone=function(e){return a.defined(e)||(e=new ot({url:this._url})),e._url=this._url,e._queryParameters=he(this._queryParameters),e._templateValues=he(this._templateValues),e.headers=he(this.headers),e.proxy=this.proxy,e.retryCallback=this.retryCallback,e.retryAttempts=this.retryAttempts,e._retryCount=0,e.request=this.request.clone(),e},ot.prototype.getBaseUri=function(e){return function(e,t){var r="",n=e.lastIndexOf("/");return-1!==n&&(r=e.substring(0,n+1)),t?(e=new ie(e),a.defined(e.query)&&(r+="?"+e.query),a.defined(e.fragment)&&(r+="#"+e.fragment),r):r}(this.getUrlComponent(e),e)},ot.prototype.appendForwardSlash=function(){var e;this._url=(0!==(e=this._url).length&&"/"===e[e.length-1]||(e+="/"),e)},ot.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})},ot.fetchArrayBuffer=function(e){return new ot(e).fetchArrayBuffer()},ot.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})},ot.fetchBlob=function(e){return new ot(e).fetchBlob()},ot.prototype.fetchImage=function(e){e=a.defaultValue(e,a.defaultValue.EMPTY_OBJECT);var t=a.defaultValue(e.preferImageBitmap,!1),r=a.defaultValue(e.preferBlob,!1),n=a.defaultValue(e.flipY,!1);if(it(this.request),!tt||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!r)return ut({resource:this,flipY:n,preferImageBitmap:t});var i,s,o,u=this.fetchBlob();return a.defined(u)?ot.supportsImageBitmapOptions().then((function(e){return i=e&&t,u})).then((function(e){if(a.defined(e)){if(o=e,i)return ot.createImageBitmapFromBlob(e,{flipY:n,premultiplyAlpha:!1});var t=window.URL.createObjectURL(e);return ut({resource:s=new ot({url:t}),flipY:n,preferImageBitmap:!1})}})).then((function(e){if(a.defined(e))return e.blob=o,i||window.URL.revokeObjectURL(s.url),e})).otherwise((function(e){return a.defined(s)&&window.URL.revokeObjectURL(s.url),e.blob=o,a.when.reject(e)})):void 0},ot.fetchImage=function(e){return new ot(e).fetchImage({flipY:e.flipY,preferBlob:e.preferBlob,preferImageBitmap:e.preferImageBitmap})},ot.prototype.fetchText=function(){return this.fetch({responseType:"text"})},ot.fetchText=function(e){return new ot(e).fetchText()},ot.prototype.fetchJson=function(){var e=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q=0.01"}});if(a.defined(e))return e.then((function(e){if(a.defined(e))return JSON.parse(e)}))},ot.fetchJson=function(e){return new ot(e).fetchJson()},ot.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})},ot.fetchXML=function(e){return new ot(e).fetchXML()},ot.prototype.fetchJsonp=function(e){var t;e=a.defaultValue(e,"callback"),it(this.request);do{t="loadJsonp"+Math.random().toString().substring(2,8)}while(a.defined(window[t]));return dt(this,e,t)},ot.fetchJsonp=function(e){return new ot(e).fetchJsonp(e.callbackParameterName)},ot.prototype._makeRequest=function(e){var t=this;it(t.request);var r=t.request;r.url=t.url,r.requestFunction=function(n){var i=e.responseType,s=le(e.headers,t.headers),o=e.overrideMimeType,u=e.method,d=e.data,c=a.when.defer(),f=a.defined(n)?n:t.url,h=ot._Implementations.loadWithXhr(f,i,u,d,s,c,o);return a.defined(h)&&a.defined(h.abort)&&(r.cancelFunction=function(){h.abort()}),c.promise};var n=ze.request(r);if(a.defined(n))return n.then((function(e){return e})).otherwise((function(n){return r.state!==qe.FAILED?a.when.reject(n):t.retryOnError(n).then((function(i){return i?(r.state=qe.UNISSUED,r.deferred=void 0,t.fetch(e)):a.when.reject(n)}))}))};var ct=/^data:(.*?)(;base64)?,(.*)$/;function ft(e,t){var r=decodeURIComponent(t);return e?atob(r):r}function ht(e,t){for(var r=ft(e,t),n=new ArrayBuffer(r.length),a=new Uint8Array(n),i=0;i<r.length;i++)a[i]=r.charCodeAt(i);return n}function lt(e,t){switch(t){case"text":return e.toString("utf8");case"json":return JSON.parse(e.toString("utf8"));default:return new Uint8Array(e).buffer}}ot.prototype.fetch=function(e){return(e=at(e,{})).method="GET",this._makeRequest(e)},ot.fetch=function(e){return new ot(e).fetch({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ot.prototype.delete=function(e){return(e=at(e,{})).method="DELETE",this._makeRequest(e)},ot.delete=function(e){return new ot(e).delete({responseType:e.responseType,overrideMimeType:e.overrideMimeType,data:e.data})},ot.prototype.head=function(e){return(e=at(e,{})).method="HEAD",this._makeRequest(e)},ot.head=function(e){return new ot(e).head({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ot.prototype.options=function(e){return(e=at(e,{})).method="OPTIONS",this._makeRequest(e)},ot.options=function(e){return new ot(e).options({responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ot.prototype.post=function(e,t){return n.Check.defined("data",e),(t=at(t,{})).method="POST",t.data=e,this._makeRequest(t)},ot.post=function(e){return new ot(e).post(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ot.prototype.put=function(e,t){return n.Check.defined("data",e),(t=at(t,{})).method="PUT",t.data=e,this._makeRequest(t)},ot.put=function(e){return new ot(e).put(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ot.prototype.patch=function(e,t){return n.Check.defined("data",e),(t=at(t,{})).method="PATCH",t.data=e,this._makeRequest(t)},ot.patch=function(e){return new ot(e).patch(e.data,{responseType:e.responseType,overrideMimeType:e.overrideMimeType})},ot._Implementations={},ot._Implementations.createImage=function(e,t,r,n,i){var s=e.url;ot.supportsImageBitmapOptions().then((function(u){if(u&&i){var d=a.when.defer(),c=ot._Implementations.loadWithXhr(s,"blob","GET",void 0,void 0,d,void 0,void 0,void 0);return a.defined(c)&&a.defined(c.abort)&&(e.cancelFunction=function(){c.abort()}),d.promise.then((function(e){if(a.defined(e))return ot.createImageBitmapFromBlob(e,{flipY:n,premultiplyAlpha:!1});r.reject(new o.RuntimeError("Successfully retrieved "+s+" but it contained no content."))})).then(r.resolve)}!function(e,t,r){var n=new Image;n.onload=function(){r.resolve(n)},n.onerror=function(e){r.reject(e)},t&&(Je.contains(e)?n.crossOrigin="use-credentials":n.crossOrigin=""),n.src=e}(s,t,r)})).otherwise(r.reject)},ot.createImageBitmapFromBlob=function(e,t){return n.Check.defined("options",t),n.Check.typeOf.bool("options.flipY",t.flipY),n.Check.typeOf.bool("options.premultiplyAlpha",t.premultiplyAlpha),createImageBitmap(e,{imageOrientation:t.flipY?"flipY":"none",premultiplyAlpha:t.premultiplyAlpha?"premultiply":"none"})};var pt="undefined"==typeof XMLHttpRequest;ot._Implementations.loadWithXhr=function(e,t,r,n,i,s,u){var d=ct.exec(e);if(null===d){if(!pt){var c=new XMLHttpRequest;if(Je.contains(e)&&(c.withCredentials=!0),e=e.replace(/{/g,"%7B").replace(/}/g,"%7D"),c.open(r,e,!0),a.defined(u)&&a.defined(c.overrideMimeType)&&c.overrideMimeType(u),a.defined(i))for(var f in i)i.hasOwnProperty(f)&&c.setRequestHeader(f,i[f]);a.defined(t)&&(c.responseType=t);var h=!1;return"string"==typeof e&&(h=0===e.indexOf("file://")||"undefined"!=typeof window&&"file://"===window.location.origin),c.onload=function(){if(!(c.status<200||c.status>=300)||h&&0===c.status){var e=c.response,n=c.responseType;if("HEAD"===r||"OPTIONS"===r){var i=c.getAllResponseHeaders().trim().split(/[\r\n]+/),u={};return i.forEach((function(e){var t=e.split(": "),r=t.shift();u[r]=t.join(": ")})),void s.resolve(u)}if(204===c.status)s.resolve();else if(!a.defined(e)||a.defined(t)&&n!==t)if("json"===t&&"string"==typeof e)try{s.resolve(JSON.parse(e))}catch(e){s.reject(e)}else(""===n||"document"===n)&&a.defined(c.responseXML)&&c.responseXML.hasChildNodes()?s.resolve(c.responseXML):""!==n&&"text"!==n||!a.defined(c.responseText)?s.reject(new o.RuntimeError("Invalid XMLHttpRequest response type.")):s.resolve(c.responseText);else s.resolve(e)}else s.reject(new Re(c.status,c.response,c.getAllResponseHeaders()))},c.onerror=function(e){s.reject(new Re)},c.send(n),c}!function(e,t,r,n,a,i,s){var u=require("url").parse(e),d="https:"===u.protocol?require("https"):require("http"),c=require("zlib"),f={protocol:u.protocol,hostname:u.hostname,port:u.port,path:u.path,query:u.query,method:r,headers:a};d.request(f).on("response",(function(e){if(e.statusCode<200||e.statusCode>=300)i.reject(new Re(e.statusCode,e,e.headers));else{var r=[];e.on("data",(function(e){r.push(e)})),e.on("end",(function(){var n=Buffer.concat(r);"gzip"===e.headers["content-encoding"]?c.gunzip(n,(function(e,r){e?i.reject(new o.RuntimeError("Error decompressing response.")):i.resolve(lt(r,t))})):i.resolve(lt(n,t))}))}})).on("error",(function(e){i.reject(new Re)})).end()}(e,t,r,0,i,s)}else s.resolve(function(e,t){t=a.defaultValue(t,"");var r=e[1],n=!!e[2],i=e[3];switch(t){case"":case"text":return ft(n,i);case"arraybuffer":return ht(n,i);case"blob":var s=ht(n,i);return new Blob([s],{type:r});case"document":return(new DOMParser).parseFromString(ft(n,i),r);case"json":return JSON.parse(ft(n,i))}}(d,t))},ot._Implementations.loadAndExecuteScript=function(e,t,r){return function(e){var t=a.when.defer(),r=document.createElement("script");r.async=!0,r.src=e;var n=document.getElementsByTagName("head")[0];return r.onload=function(){r.onload=void 0,n.removeChild(r),t.resolve()},r.onerror=function(e){t.reject(e)},n.appendChild(r),t.promise}(e).otherwise(r.reject)},ot._DefaultImplementations={},ot._DefaultImplementations.createImage=ot._Implementations.createImage,ot._DefaultImplementations.loadWithXhr=ot._Implementations.loadWithXhr,ot._DefaultImplementations.loadAndExecuteScript=ot._Implementations.loadAndExecuteScript,ot.DEFAULT=Object.freeze(new ot({url:"undefined"==typeof document?"":document.location.href.split("?")[0]}));var mt,yt,vt,Ct=/((?:.*\/)|^)SuperMap3D\.js$/;function gt(e){return"undefined"==typeof document?e:(a.defined(mt)||(mt=document.createElement("a")),mt.href=e,mt.href=mt.href,mt.href)}function qt(){return a.defined(yt)||(e="undefined"!=typeof CESIUM_BASE_URL?CESIUM_BASE_URL:"object"==typeof define&&a.defined(define.amd)&&!define.amd.toUrlUndefined&&a.defined(require.toUrl)?pe("..",Rt("Core/buildModuleUrl.js")):function(){for(var e=document.getElementsByTagName("script"),t=0,r=e.length;t<r;++t){var n=e[t].getAttribute("src"),a=Ct.exec(n);if(null!==a)return a[1]}}(),(yt=new ot({url:gt(e)})).appendForwardSlash()),yt;var e}function wt(e){return gt(require.toUrl("../"+e))}function _t(e){return qt().getDerivedResource({url:e}).url}function Rt(e){return a.defined(vt)||(vt="object"==typeof define&&a.defined(define.amd)&&!define.amd.toUrlUndefined&&a.defined(require.toUrl)?wt:_t),vt(e)}Rt._buildModuleUrlFromBaseUrl=_t,Rt._clearBaseResource=function(){yt=void 0},Rt.setBaseUrl=function(e){yt=ot.DEFAULT.getDerivedResource({url:e})},Rt.getCesiumBaseUrl=qt,e.BoundingSphere=w,e.Ellipsoid=d,e.GeographicProjection=m,e.Intersect=y,e.Interval=v,e.Rectangle=C,e.Resource=ot,e.buildModuleUrl=Rt,e.oneTimeWarning=$e}));
