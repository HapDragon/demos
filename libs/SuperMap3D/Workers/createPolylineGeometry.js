define(["./when-b60132fc","./buildModuleUrl-9a89655b","./EllipsoidRhumbLine-d305ae76","./Cartesian4-69ef58e5","./Color-4c32522e","./FeatureDetection-ab6f364c","./Check-7b2a090c","./GeometryAttribute-f3b3c776","./GeometryAttributes-252e9929","./IndexDatatype-d62ee188","./Math-119be1a3","./Cartographic-00721f3e","./EllipsoidGeodesic-dbda39ad","./Plane-622eaee2","./Cartesian2-99e64452","./PrimitiveType-ebb8c588","./VertexFormat-6446fca0","./WebGLConstants-aba9fc67","./Transforms-f4127659"],(function(e,a,r,t,i,n,o,l,s,c,u,p,d,h,f,C,m,v,y){"use strict";var g={numberOfPoints:function(e,a,r){var i=t.Cartesian3.distance(e,a);return Math.ceil(i/r)},numberOfPointsRhumbLine:function(e,a,r){var t=Math.pow(e.longitude-a.longitude,2)+Math.pow(e.latitude-a.latitude,2);return Math.ceil(Math.sqrt(t/(r*r)))}},w=new p.Cartographic;g.extractHeights=function(e,a){for(var r=e.length,t=new Array(r),i=0;i<r;i++){var n=e[i];t[i]=a.cartesianToCartographic(n,w).height}return t};var T=new f.Matrix4,A=new t.Cartesian3,_=new t.Cartesian3,E=new h.Plane(t.Cartesian3.UNIT_X,0),P=new t.Cartesian3,b=new h.Plane(t.Cartesian3.UNIT_X,0),x=new t.Cartesian3,D=new t.Cartesian3,G=[];function S(e,a,r){var t,i=G;if(i.length=e,a===r){for(t=0;t<e;t++)i[t]=a;return i}var n=(r-a)/e;for(t=0;t<e;t++){var o=a+t*n;i[t]=o}return i}var V=new p.Cartographic,k=new p.Cartographic,L=new t.Cartesian3,M=new t.Cartesian3,F=new t.Cartesian3,R=new d.EllipsoidGeodesic,O=new r.EllipsoidRhumbLine;function I(e,a,r,i,n,o,l,s,c){var u=i.scaleToGeodeticSurface(e,M),p=i.scaleToGeodeticSurface(a,F),d=g.numberOfPoints(e,a,r),h=i.cartesianToCartographic(u,V),f=i.cartesianToCartographic(p,k),C=S(d,n,o);c>0&&(C=function(e,a){var r=G;r.length=e;for(var t=0;t<e;t++)r[t]=a*Math.sin(Math.PI*t/e);return r}(d,c)),R.setEndPoints(h,f);var m=R.surfaceDistance/d,v=s;h.height=n;var y=i.cartographicToCartesian(h,L);t.Cartesian3.pack(y,l,v),v+=3;for(var w=1;w<d;w++){var T=R.interpolateUsingSurfaceDistance(w*m,k);T.height=C[w],y=i.cartographicToCartesian(T,L),t.Cartesian3.pack(y,l,v),v+=3}return v}function N(e,a,i,n,o,l,s,c){var u=n.scaleToGeodeticSurface(e,M),p=n.scaleToGeodeticSurface(a,F),d=n.cartesianToCartographic(u,V),h=n.cartesianToCartographic(p,k),f=g.numberOfPointsRhumbLine(d,h,i),C=S(f,o,l);O.ellipsoid.equals(n)||(O=new r.EllipsoidRhumbLine(void 0,void 0,n)),O.setEndPoints(d,h);var m=O.surfaceDistance/f,v=c;d.height=o;var y=n.cartographicToCartesian(d,L);t.Cartesian3.pack(y,s,v),v+=3;for(var w=1;w<f;w++){var T=O.interpolateUsingSurfaceDistance(w*m,k);T.height=C[w],y=n.cartographicToCartesian(T,L),t.Cartesian3.pack(y,s,v),v+=3}return v}g.wrapLongitude=function(a,r){var i=[],n=[];if(e.defined(a)&&a.length>0){r=e.defaultValue(r,f.Matrix4.IDENTITY);var o=f.Matrix4.inverseTransformation(r,T),l=f.Matrix4.multiplyByPoint(o,t.Cartesian3.ZERO,A),s=t.Cartesian3.normalize(f.Matrix4.multiplyByPointAsVector(o,t.Cartesian3.UNIT_Y,_),_),c=h.Plane.fromPointNormal(l,s,E),u=t.Cartesian3.normalize(f.Matrix4.multiplyByPointAsVector(o,t.Cartesian3.UNIT_X,P),P),p=h.Plane.fromPointNormal(l,u,b),d=1;i.push(t.Cartesian3.clone(a[0]));for(var C=i[0],m=a.length,v=1;v<m;++v){var y=a[v];if(h.Plane.getPointDistance(p,C)<0||h.Plane.getPointDistance(p,y)<0){var g=h.IntersectionTests.lineSegmentPlane(C,y,c,x);if(e.defined(g)){var w=t.Cartesian3.multiplyByScalar(s,5e-9,D);h.Plane.getPointDistance(c,C)<0&&t.Cartesian3.negate(w,w),i.push(t.Cartesian3.add(g,w,new t.Cartesian3)),n.push(d+1),t.Cartesian3.negate(w,w),i.push(t.Cartesian3.add(g,w,new t.Cartesian3)),d=1}}i.push(t.Cartesian3.clone(a[v])),d++,C=y}n.push(d)}return{positions:i,lengths:n}},g.generateArc=function(r){e.defined(r)||(r={});var i=r.positions,n=i.length,o=e.defaultValue(r.ellipsoid,a.Ellipsoid.WGS84),l=e.defaultValue(r.height,0),s=Array.isArray(l);if(n<1)return[];if(1===n){var c=o.scaleToGeodeticSurface(i[0],M);if(0!==(l=s?l[0]:l)){var p=o.geodeticSurfaceNormal(c,L);t.Cartesian3.multiplyByScalar(p,l,p),t.Cartesian3.add(c,p,c)}return[c.x,c.y,c.z]}var d=r.minDistance;if(!e.defined(d)){var h=e.defaultValue(r.granularity,u.CesiumMath.RADIANS_PER_DEGREE);d=u.CesiumMath.chordLength(h,o.maximumRadius)}var f,C=0;for(f=0;f<n-1;f++)C+=g.numberOfPoints(i[f],i[f+1],d);var m=r.hMax,v=3*(C+1),y=new Array(v),w=0;for(f=0;f<n-1;f++){w=I(i[f],i[f+1],d,o,s?l[f]:l,s?l[f+1]:l,y,w,m)}G.length=0;var T=i[n-1],A=o.cartesianToCartographic(T,V);A.height=s?l[n-1]:l;var _=o.cartographicToCartesian(A,L);return t.Cartesian3.pack(_,y,v-3),y};var B=new p.Cartographic,U=new p.Cartographic;g.generateRhumbArc=function(r){e.defined(r)||(r={});var i=r.positions,n=i.length,o=e.defaultValue(r.ellipsoid,a.Ellipsoid.WGS84),l=e.defaultValue(r.height,0),s=Array.isArray(l);if(n<1)return[];if(1===n){var c=o.scaleToGeodeticSurface(i[0],M);if(0!==(l=s?l[0]:l)){var d=o.geodeticSurfaceNormal(c,L);t.Cartesian3.multiplyByScalar(d,l,d),t.Cartesian3.add(c,d,c)}return[c.x,c.y,c.z]}var h,f,C=e.defaultValue(r.granularity,u.CesiumMath.RADIANS_PER_DEGREE),m=0,v=o.cartesianToCartographic(i[0],B);for(h=0;h<n-1;h++)f=o.cartesianToCartographic(i[h+1],U),m+=g.numberOfPointsRhumbLine(v,f,C),v=p.Cartographic.clone(f,B);var y=3*(m+1),w=new Array(y),T=0;for(h=0;h<n-1;h++){T=N(i[h],i[h+1],C,o,s?l[h]:l,s?l[h+1]:l,w,T)}G.length=0;var A=i[n-1],_=o.cartesianToCartographic(A,V);_.height=s?l[n-1]:l;var E=o.cartographicToCartesian(_,L);return t.Cartesian3.pack(E,w,y-3),w},g.generateCartesianArc=function(e){for(var a=g.generateArc(e),r=a.length/3,i=new Array(r),n=0;n<r;n++)i[n]=t.Cartesian3.unpack(a,3*n);return i},g.generateCartesianRhumbArc=function(e){for(var a=g.generateRhumbArc(e),r=a.length/3,i=new Array(r),n=0;n<r;n++)i[n]=t.Cartesian3.unpack(a,3*n);return i};var W=[];function z(e,a,r,t,n){var o,l=W;l.length=n;var s=r.red,c=r.green,u=r.blue,p=r.alpha,d=t.red,h=t.green,f=t.blue,C=t.alpha;if(i.Color.equals(r,t)){for(o=0;o<n;o++)l[o]=i.Color.clone(r);return l}var m=(d-s)/n,v=(h-c)/n,y=(f-u)/n,g=(C-p)/n;for(o=0;o<n;o++)l[o]=new i.Color(s+o*m,c+o*v,u+o*y,p+o*g);return l}function Y(n){var o,l,s=(n=e.defaultValue(n,e.defaultValue.EMPTY_OBJECT)).positions,c=n.colors,p=e.defaultValue(n.width,1),d=e.defaultValue(n.hMax,-1),h=e.defaultValue(n.colorsPerVertex,!1);this._positions=s,this._colors=c,this._width=p,this._hMax=d,this._colorsPerVertex=h,this._dist=n.dist,this._period=n.period,this._vertexFormat=m.VertexFormat.clone(e.defaultValue(n.vertexFormat,m.VertexFormat.DEFAULT)),this._followSurface=e.defaultValue(n.followSurface,!0),e.defined(n.followSurface)&&(o="PolylineGeometry.followSurface",l="PolylineGeometry.followSurface is deprecated and will be removed in Cesium 1.55. Use PolylineGeometry.arcType instead.",a.oneTimeWarning(o,l),n.arcType=n.followSurface?r.ArcType.GEODESIC:r.ArcType.NONE),this._arcType=e.defaultValue(n.arcType,r.ArcType.GEODESIC),this._followSurface=this._arcType!==r.ArcType.NONE,this._granularity=e.defaultValue(n.granularity,u.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=a.Ellipsoid.clone(e.defaultValue(n.ellipsoid,a.Ellipsoid.WGS84)),this._workerName="createPolylineGeometry";var f=1+s.length*t.Cartesian3.packedLength;f+=e.defined(c)?1+c.length*i.Color.packedLength:1,this.packedLength=f+a.Ellipsoid.packedLength+m.VertexFormat.packedLength+4+2}Y.pack=function(r,n,o){var l;o=e.defaultValue(o,0);var s=r._positions,c=s.length;for(n[o++]=c,l=0;l<c;++l,o+=t.Cartesian3.packedLength)t.Cartesian3.pack(s[l],n,o);var u=r._colors;for(c=e.defined(u)?u.length:0,n[o++]=c,l=0;l<c;++l,o+=i.Color.packedLength)i.Color.pack(u[l],n,o);return a.Ellipsoid.pack(r._ellipsoid,n,o),o+=a.Ellipsoid.packedLength,m.VertexFormat.pack(r._vertexFormat,n,o),o+=m.VertexFormat.packedLength,n[o++]=r._width,n[o++]=r._colorsPerVertex?1:0,n[o++]=r._arcType,n[o++]=r._granularity,n[o++]=r._hMax,n[o++]=r._dist,n[o]=r._period,n};var q=a.Ellipsoid.clone(a.Ellipsoid.UNIT_SPHERE),H=new m.VertexFormat,X={positions:void 0,colors:void 0,ellipsoid:q,vertexFormat:H,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};Y.unpack=function(r,n,o){var l;n=e.defaultValue(n,0);var s=r[n++],c=new Array(s);for(l=0;l<s;++l,n+=t.Cartesian3.packedLength)c[l]=t.Cartesian3.unpack(r,n);var u=(s=r[n++])>0?new Array(s):void 0;for(l=0;l<s;++l,n+=i.Color.packedLength)u[l]=i.Color.unpack(r,n);var p=a.Ellipsoid.unpack(r,n,q);n+=a.Ellipsoid.packedLength;var d=m.VertexFormat.unpack(r,n,H);n+=m.VertexFormat.packedLength;var h=r[n++],f=1===r[n++],C=r[n++],v=r[n++],y=r[n++],g=1==r[n++],w=r[n];return e.defined(o)?(o._positions=c,o._colors=u,o._ellipsoid=a.Ellipsoid.clone(p,o._ellipsoid),o._vertexFormat=m.VertexFormat.clone(d,o._vertexFormat),o._width=h,o._colorsPerVertex=f,o._arcType=C,o._granularity=v,o._hMax=y,o._dist=g,o._period=w,o):(X.positions=c,X.colors=u,X.width=h,X.colorsPerVertex=f,X.arcType=C,X.granularity=v,X.hMax=y,X.dist=g,X.period=w,new Y(X))};var J=new t.Cartesian3,Z=new t.Cartesian3,j=new t.Cartesian3,K=new t.Cartesian3;return Y.createGeometry=function(o){var p,d,h,f=o._width,m=o._hMax,v=o._vertexFormat,y=o._colors,w=o._colorsPerVertex,T=o._arcType,A=o._granularity,_=o._ellipsoid,E=o._dist,P=o._period,b=r.arrayRemoveDuplicates(o._positions,t.Cartesian3.equalsEpsilon),x=b.length;if(!(x<2||f<=0)){if(T===r.ArcType.GEODESIC||T===r.ArcType.RHUMB){var D,G;T===r.ArcType.GEODESIC?(D=u.CesiumMath.chordLength(A,_.maximumRadius),G=g.numberOfPoints):(D=A,G=g.numberOfPointsRhumbLine);var S=g.extractHeights(b,_);if(e.defined(y)){var V=1;for(p=0;p<x-1;++p)V+=G(b[p],b[p+1],D);var k=new Array(V),L=0;for(p=0;p<x-1;++p){var M=b[p],F=b[p+1],R=y[p],O=G(M,F,D);if(w&&p<V){var I=z(0,0,R,y[p+1],O),N=I.length;for(d=0;d<N;++d)k[L++]=I[d]}else for(d=0;d<O;++d)k[L++]=i.Color.clone(R)}k[L]=i.Color.clone(y[y.length-1]),y=k,W.length=0}b=T===r.ArcType.GEODESIC?g.generateCartesianArc({positions:b,minDistance:D,ellipsoid:_,height:S,hMax:m}):g.generateCartesianRhumbArc({positions:b,granularity:D,ellipsoid:_,height:S})}var B,U=4*(x=b.length)-4,Y=new Float64Array(3*U),q=new Float64Array(3*U),H=new Float64Array(3*U),X=new Float32Array(2*U),Q=v.st?new Float32Array(2*U):void 0,$=e.defined(y)?new Uint8Array(4*U):void 0,ee=E?new Float32Array(3*U):void 0,ae=0,re=0,te=0,ie=0,ne=0,oe=0;for(d=0;d<x;++d){var le,se;0===d?(B=J,t.Cartesian3.subtract(b[0],b[1],B),t.Cartesian3.add(b[0],B,B)):B=b[d-1],t.Cartesian3.clone(B,j),t.Cartesian3.clone(b[d],Z),d===x-1?(B=J,t.Cartesian3.subtract(b[x-1],b[x-2],B),t.Cartesian3.add(b[x-1],B,B)):B=b[d+1],t.Cartesian3.clone(B,K),e.defined($)&&(le=0===d||w?y[d]:y[d-1],d!==x-1&&(se=y[d]));var ce=d===x-1?2:4;for(h=0===d?2:0;h<ce;++h){t.Cartesian3.pack(Z,Y,ae),t.Cartesian3.pack(j,q,ae),t.Cartesian3.pack(K,H,ae),ae+=3;var ue=h-2<0?-1:1,pe=h%2*2-1,de=pe*d/x;if(X[re++]=m>0?de:pe,X[re++]=ue*f,v.st&&(Q[te++]=d/(x-1),Q[te++]=Math.max(X[re-2],0)),e.defined($)){var he=h<2?le:se;$[ie++]=i.Color.floatToByte(he.red),$[ie++]=i.Color.floatToByte(he.green),$[ie++]=i.Color.floatToByte(he.blue),$[ie++]=i.Color.floatToByte(he.alpha)}E&&(ee[3*ne]=oe,ne++)}oe+=t.Cartesian3.distance(B,b[d])}if(E){var fe=oe,Ce=Math.random()*(P>0?P:fe);for(d=0;d<U;d++)ee[3*d+1]=fe,ee[3*d+2]=Ce}var me=new s.GeometryAttributes;me.position=new l.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:Y}),me.prevPosition=new l.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:q}),me.nextPosition=new l.GeometryAttribute({componentDatatype:n.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:H}),me.expandAndWidth=new l.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:X}),v.st&&(me.st=new l.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:Q})),e.defined($)&&(me.color=new l.GeometryAttribute({componentDatatype:n.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:$,normalize:!0})),E&&(me.dist=new l.GeometryAttribute({componentDatatype:n.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:ee}));var ve=c.IndexDatatype.createTypedArray(U,6*x-6),ye=0,ge=0,we=x-1;for(d=0;d<we;++d)ve[ge++]=ye,ve[ge++]=ye+2,ve[ge++]=ye+1,ve[ge++]=ye+1,ve[ge++]=ye+2,ve[ge++]=ye+3,ye+=4;return new l.Geometry({attributes:me,indices:ve,primitiveType:C.PrimitiveType.TRIANGLES,boundingSphere:a.BoundingSphere.fromPoints(b),geometryType:l.GeometryType.POLYLINES})}},function(r,t){return e.defined(t)&&(r=Y.unpack(r,t)),r._ellipsoid=a.Ellipsoid.clone(r._ellipsoid),Y.createGeometry(r)}}));
